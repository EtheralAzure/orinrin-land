;※※※※※※※※※※※※※※※※※※※※※※※※※※※※
;eraTheWorld 4.954 画蛇又添足 火焰猫燐别人版口上
;※※※※※※※※※※※※※※※※※※※※※※※※※※※※

;※※※※※※※※※※※※※※※※※※※※※※※※※※※※
;SUCCESS系
;※※※※※※※※※※※※※※※※※※※※※※※※※※※※

;==================================================
;统一SUCCESS函数
;==================================================
@M_KOJO_AME_SUCCESS_K36_GENERAL
#LOCALSIZE 1
#LOCALSSIZE 1
SELECTCASE SELECTCOM
    CASE 304, 332, 333, 334, 335, 411, 412, 413, 445, 446, 448, 449, 480, 626
        SIF AME36_FALL_STATE() < 1
            TFLAG:192 = -2
    CASE 302, 305, 307, 309, 311, 336, 403, 431, 432, 436, 440, 442, 447, 603, 605, 610, 614, 617, 621
        SIF AME36_FALL_STATE() < 2
            TFLAG:192 = -2
    CASE 306, 308, 310, 312, 330, 354, 417, 615
        SIF AME36_FALL_STATE() < 3
            TFLAG:192 = -2
    CASE 350
        SIF AME36_FALL_STATE() < 4
            TFLAG:192 = -2
    CASE 357
        TFLAG:192 = -2
ENDSELECT
IF TFLAG:192 == -2
    IF GROUPMATCH(SELECTCOM, 411, 412, 413, 436, 445, 446, 448, 449, 621)
        TFLAG:192 = 0
        IF CFLAG:ASLEEP_AMER == 0
            CFLAG:AME36_SLEEPY_MAGIC = CFLAG:ACTION_AMER + 100
            CFLAG:ASLEEP_AMER = 1
            CFLAG:ACTION_AMER = 5
        ENDIF
    ELSE
        SELECTCOM = 298
    ENDIF
    CFLAG:AME36_SUPPRESSION_TRIGGER = 1
ENDIF


;※※※※※※※※※※※※※※※※※※※※※※※※※※※※
;杂项
;※※※※※※※※※※※※※※※※※※※※※※※※※※※※

;==================================================
;自定义陷落条件检测
;==================================================
@M_KOJO_AME_CHECK_K36_FALL_STATE_OVERRIDE(ARGS, ARG, ARG:1)
#LOCALSIZE 1
#LOCALSSIZE 1
RETURN 1

;==================================================
;自定义陷落条件判定与显示
;==================================================
@M_KOJO_AME_CHECK_K36_FALL_STATE(ARGS, ARG, ARG:1)
#LOCALSIZE 1
#LOCALSSIZE 1
SELECTCASE ARGS
    ;--------------------------------------------------
    ;思慕
    ;--------------------------------------------------
    CASE "YEARNING"
        RESULTS:1 = 思慕未达成的条件
        RESULT:1 = 0
        RESULTS:2 = 思慕已达成的条件
        RESULT:2 = 1
        RETURN 2
    ;--------------------------------------------------
    ;恋慕
    ;--------------------------------------------------
    CASE "LOVE"
        RESULTS:1 = 恋慕未达成的条件
        RESULT:1 = 0
        RESULTS:2 = 恋慕已达成的条件
        RESULT:2 = 1
        RETURN 2
    ;--------------------------------------------------
    ;炮友
    ;--------------------------------------------------
    CASE "FUCK BUDDY"
        RESULTS:1 = 取得不可
        RESULT:1 = 0
        RETURN 1
    ;--------------------------------------------------
    ;爱欲
    ;--------------------------------------------------
    CASE "LUST"
        RESULTS:1 = 取得不可
        RESULT:1 = 0
        RETURN 1
ENDSELECT
RETURN 0

;==================================================
;刻印取得的MESSAGECHECK
;因为调用比较靠后拿来当作EXTRASOURCE的补充了
;==================================================
@M_KOJO_AME_MESSAGE_MARKCNG_MESSAGECHECK_K36
#LOCALSIZE 1
#LOCALSSIZE 1
;--------------------------------------------------
;禁用原版的好感和信赖上升，并提前进行好感和信赖上升
;--------------------------------------------------
TFLAG:97 = 9999
TFLAG:13 = 1
TFLAG:98 = 0
CFLAG:FAVOR_AMER += CFLAG:AME36_COM_FAVOR
CFLAG:TRUST_AMER += CFLAG:AME36_COM_TRUST
RETURN 0

;==================================================
;统一COM和SCOM的EXTRASOURCE
;==================================================
@AME36_EXTRASOURCE_GENERAL(UNIFIED_COM)
#LOCALSIZE 5
#LOCALSSIZE 1
#DIM UNIFIED_COM
#DIM DYNAMIC IRREGULAR_TFLAG
#DIM COM_EQUIVALENT
#DIM PERCENTAGE_DUPE
#DIM EXP_ADD
#DIM DYNAMIC MONO
;--------------------------------------------------
;标记本回合确实被选中为TARGET
;用于清除非TARGET的PALAM上升
;--------------------------------------------------
CFLAG:AME36_IS_TARGET = 1
;--------------------------------------------------
;时停就不管了
;--------------------------------------------------
IF FLAG:TIMESTOP_AMER
    CALL AME36_TIMES_RELAVENT_SOURCE(30)
    RETURN -1
;--------------------------------------------------
;若非时停，重置搬动检测
;--------------------------------------------------
ELSE
    CFLAG:AME36_TP_INDEX = 0
ENDIF
;--------------------------------------------------
;恋慕之前不会烂醉
;--------------------------------------------------
BASE:DRUNKENNESS_AMER = MIN(BASE:DRUNKENNESS_AMER, (BASE:DRUNKENNESS_AMER * 4 / 5) - 1)
;--------------------------------------------------
;先清除一切非快SOURCE和情绪、理性BONUS
;哎呀、一不小心把奇迹之石清除了、这该怎么办呢
;--------------------------------------------------
CALL AME36_CLEAR_SOURCE
TFLAG:92 = 0
TFLAG:90 = 0
CFLAG:339 = 0
;--------------------------------------------------
;本来TFLAG:192 == -2的时候应当跳过这个函数，但有的COM就不这样做，真讨厌
;--------------------------------------------------
IF CFLAG:AME36_SLEEPY_MAGIC
    CFLAG:ASLEEP_AMER = 0
    CFLAG:ACTION_AMER = CFLAG:AME36_SLEEPY_MAGIC - 100
    CFLAG:AME36_SLEEPY_MAGIC = 0
    RETURN -1
ENDIF
;--------------------------------------------------
;不该SOURCE的不要SOURCE
;--------------------------------------------------
SIF CFLAG:ANGRY_AMER || CFLAG:ASLEEP_AMER
    RETURN -1
;--------------------------------------------------
;全面覆盖本体COM的SOURCE
;--------------------------------------------------
SELECTCASE UNIFIED_COM
    ;--------------------------------------------------
    ;300 - 会话 (10min)
    ;--------------------------------------------------
    CASE 300
        ;--------------------------------------------------
        ;如果会话积累值太高，那就结束啦
        ;--------------------------------------------------
        SIF TCVAR:302 && !TALENT:AFFECTION_AMER
            RETURN -1
        SIF CFLAG:SNUGGLE_AMER
	        SOURCE:SLOVE_AMER = 200
        SOURCE:SJOY_AMER = 150
        SOURCE:SPASSIVITY_AMER = 50
        SOURCE:SCONQUEST_AMER = 50
        ;--------------------------------------------------
        ;根据MASTER的会话技能等级乘算
        ;--------------------------------------------------
        SELECTCASE ABL:MASTER:DICTION_AMER
            CASE 0
                TIMES SOURCE:SJOY_AMER , 0.80
		        TIMES SOURCE:SPASSIVITY_AMER , 0.50
		        TIMES SOURCE:SCONQUEST_AMER , 0.50
            CASE 1
                TIMES SOURCE:SJOY_AMER , 0.90
		        TIMES SOURCE:SPASSIVITY_AMER , 0.70
		        TIMES SOURCE:SCONQUEST_AMER , 0.70
            CASE 2
                TIMES SOURCE:SJOY_AMER , 0.95
		        TIMES SOURCE:SPASSIVITY_AMER , 0.90
		        TIMES SOURCE:SCONQUEST_AMER , 0.90
            CASE 3
                ;TIMES SOURCE:SJOY_AMER , 1.00
		        ;TIMES SOURCE:SPASSIVITY_AMER , 1.00
		        ;TIMES SOURCE:SCONQUEST_AMER , 1.00
            CASE 4
                TIMES SOURCE:SJOY_AMER , 1.05
		        TIMES SOURCE:SPASSIVITY_AMER , 1.10
		        TIMES SOURCE:SCONQUEST_AMER , 1.10
            CASE 5
                TIMES SOURCE:SJOY_AMER , 1.10
		        TIMES SOURCE:SPASSIVITY_AMER , 1.20
		        TIMES SOURCE:SCONQUEST_AMER , 1.20
            CASE 6
                TIMES SOURCE:SJOY_AMER , 1.25
		        TIMES SOURCE:SPASSIVITY_AMER , 1.50
		        TIMES SOURCE:SCONQUEST_AMER , 1.50
        ENDSELECT
    ;--------------------------------------------------
    ;301 - 泡茶 (30min)
    ;--------------------------------------------------
    CASE 301
        SOURCE:SJOY_AMER = 250
        SOURCE:SPASSIVITY_AMER = 150
        SOURCE:SCONQUEST_AMER = 150
        ;--------------------------------------------------
        ;使用红茶的加成
        ;--------------------------------------------------
        IF GETBIT(TCVAR:MASTER:143, 0)
            TIMES SOURCE:SJOY_AMER , 1.75
		    TIMES SOURCE:SPASSIVITY_AMER , 1.20
		    TIMES SOURCE:SCONQUEST_AMER , 1.20
        ENDIF
        CFLAG:AME36_COM_TRUST = 1
    ;--------------------------------------------------
    ;302 - 身体接触 (10min)
    ;--------------------------------------------------
    CASE 302
        SOURCE:SJOY_AMER = 100
        SOURCE:SLOVE_AMER = 80
        SOURCE:SPASSIVITY_AMER = 60
        SOURCE:SEXPOSURE_AMER = 20
    ;--------------------------------------------------
    ;303 - 道歉
    ;--------------------------------------------------
    CASE 303
        SELECTCASE TFLAG:193
        CASE 0, 1, 2
            SOURCE:SJOY_AMER = 100
            SOURCE:SCONQUEST_AMER = 300
        CASE -1, -2
            SOURCE:SCONQUEST_AMER = 150
        ENDSELECT
        IRREGULAR_TFLAG = 1
    ;--------------------------------------------------
    ;304 - 帮忙干活 (60min)
    ;--------------------------------------------------
    CASE 304
        SOURCE:SJOY_AMER = 400
        SOURCE:SPASSIVITY_AMER = 250
        SOURCE:SCONQUEST_AMER = 250
        CFLAG:AME36_COM_TRUST = 1
    ;--------------------------------------------------
    ;305, 336 - 膝枕/索求膝枕 (20min)
    ;--------------------------------------------------
    CASE 305, 336
        SOURCE:SJOY_AMER = 180
        SOURCE:SLOVE_AMER = 150
        SOURCE:SPASSIVITY_AMER = 150
        SOURCE:SEXPOSURE_AMER = 50
        CFLAG:AME36_COM_TRUST = 1
    ;--------------------------------------------------
    ;306 - 抚摸小腹 (10min)
    ;--------------------------------------------------
    CASE 306
        SOURCE:SJOY_AMER = 120
        SOURCE:SLOVE_AMER = 100
        SOURCE:SLUST_AMER = 30
        SOURCE:SPASSIVITY_AMER = 60
        SOURCE:SEXPOSURE_AMER = 10
        IRREGULAR_TFLAG = 1
    ;--------------------------------------------------
    ;307 - 捏脸蛋 (10min)
    ;--------------------------------------------------
    CASE 307
        SOURCE:SJOY_AMER = 120
        SOURCE:SLOVE_AMER = 80
        SOURCE:SPASSIVITY_AMER = 60
        SOURCE:SEXPOSURE_AMER = 50
        SOURCE:SPAIN_AMER = 50
    ;--------------------------------------------------
    ;308 - 捅脸颊 (10min)
    ;--------------------------------------------------
    CASE 308
        SOURCE:SJOY_AMER = 50
        IF CFLAG:SNUGGLE_AMER
            SOURCE:SJOY_AMER += 50
            SOURCE:SLOVE_AMER = 120
        ENDIF
        SOURCE:SPASSIVITY_AMER = 100
        SOURCE:SSUBMISSION_AMER = 150
    ;--------------------------------------------------
    ;309 - 摸头 (10min)
    ;--------------------------------------------------
    CASE 309
        SOURCE:SJOY_AMER = 100
        SOURCE:SLOVE_AMER = 120
        SOURCE:SPASSIVITY_AMER = 80
        SOURCE:SEXPOSURE_AMER = 50
        SOURCE:SSUBMISSION_AMER = 50
        CFLAG:AME36_COM_TRUST = 1
    ;--------------------------------------------------
    ;310 - 摸屁股 (10min)
    ;--------------------------------------------------
    CASE 310
        SOURCE:SJOY_AMER = 50
        SOURCE:SLOVE_AMER = 100
        SOURCE:SLUST_AMER = 50
        SOURCE:SPASSIVITY_AMER = 60
        SOURCE:SEXPOSURE_AMER = 80
        ;--------------------------------------------------
        ;不知道为什么这里TFLAG搞特殊，直接一般化了
        ;--------------------------------------------------
        SELECTCASE TFLAG:193
            CASE 1
                TFLAG:193 = -1
            CASE 2, 3
                TFLAG:193 = 0
            CASE 4
                TFLAG:193 = 1
        ENDSELECT
    ;--------------------------------------------------
    ;311 - 拥抱 (10min)
    ;--------------------------------------------------
    CASE 311
        SOURCE:SJOY_AMER = 120
        SOURCE:SLOVE_AMER = 100
        SOURCE:SPASSIVITY_AMER = 60
        SOURCE:SEXPOSURE_AMER = 50
    ;--------------------------------------------------
    ;330 - 掀起裙子 (5min)
    ;--------------------------------------------------
    CASE 330
        SOURCE:SJOY_AMER = 50
        SOURCE:SLOVE_AMER = 50
        SOURCE:SLUST_AMER = 50
        SOURCE:SPASSIVITY_AMER = 120
        SOURCE:SEXPOSURE_AMER = 300
        ;--------------------------------------------------
        ;WIP - 此处有自定义SUCCESS的必要
        ;--------------------------------------------------
        IRREGULAR_TFLAG = 1
    ;--------------------------------------------------
    ;332 - 劝酒 (30min)
    ;--------------------------------------------------
    CASE 332
        SOURCE:SJOY_AMER = 30 * ALCOHOL_TASTE(TFLAG:194)
        SOURCE:SPASSIVITY_AMER = 150
        IRREGULAR_TFLAG = 1
        ;--------------------------------------------------
        ;喝过酒种类的记录
        ;--------------------------------------------------
        SELECTCASE TFLAG:194
            CASE 51 TO 56
                SETBIT CFLAG:AME36_ALCOHOL_TYPE, TFLAG:194 - 51
            CASE 58 TO 59
                SETBIT CFLAG:AME36_ALCOHOL_TYPE, TFLAG:194 - 52
            CASE 513
                SETBIT CFLAG:AME36_ALCOHOL_TYPE, 8
            CASE 560 TO 575
                SETBIT CFLAG:AME36_ALCOHOL_TYPE, TFLAG:194 - 551
            CASE 577 TO 586
                SETBIT CFLAG:AME36_ALCOHOL_TYPE, TFLAG:194 - 552
        ENDSELECT
    ;--------------------------------------------------
    ;333 - 听牢骚 (20min)
    ;--------------------------------------------------
    CASE 333
        SOURCE:SJOY_AMER = 300
        SOURCE:SCONQUEST_AMER = 200
        ;--------------------------------------------------
        ;因为没有什么对TFLAG:193进行特殊处理的必要，所以直接一般化了
        ;--------------------------------------------------
        SIF TFLAG:193 == 1 && TFLAG:193 == 4
            TFLAG:193 = -1
        SIF TFLAG:193 == 2 && TFLAG:193 == 5
            TFLAG:193 = 0
        SIF TFLAG:193 == 3 && TFLAG:193 == 6
            TFLAG:193 = 1
        CFLAG:AME36_COM_TRUST = 1
    ;--------------------------------------------------
    ;334 - 碰杯 (30min)
    ;--------------------------------------------------
    CASE 334
        SOURCE:SJOY_AMER = 300
        SOURCE:SPASSIVITY_AMER = 50
        SOURCE:SCONQUEST_AMER = 50
    ;--------------------------------------------------
    ;335 - 照料 (30min)
    ;待确认：这玩意真的能触发嘛？
    ;--------------------------------------------------
    CASE 335
        SOURCE:SJOY_AMER = 100
        SOURCE:SPASSIVITY_AMER = 300
        SOURCE:SCONQUEST_AMER = 100
        SOURCE:SEXPOSURE_AMER = 50
        SOURCE:SSUBMISSION_AMER = 300
        CFLAG:AME36_COM_TRUST = 1
    ;--------------------------------------------------
    ;403 - 休憩 (60min)
    ;--------------------------------------------------
    CASE 403
        ;--------------------------------------------------
        ;若不会被选为TARGET，则直接RETURN
        ;--------------------------------------------------
        SIF CFLAG:ATTITUDE_AMER == 0
            RETURN -1
        SOURCE:SJOY_AMER = 50
        IRREGULAR_TFLAG = 1
    ;--------------------------------------------------
    ;410 - 扫除 (5min)
    ;--------------------------------------------------
    CASE 410
        SOURCE:SJOY_AMER = 100
        SOURCE:SPASSIVITY_AMER = 50
        SOURCE:SACHIEVEMENT_AMER = 30
        ;--------------------------------------------------
        ;根据MASTER的清扫技能等级乘算
        ;--------------------------------------------------
        SELECTCASE ABL:MASTER:CLEANING_AMER
            CASE 0
                TIMES SOURCE:SJOY_AMER, 0.80
                TIMES SOURCE:SPASSIVITY_AMER, 0.50
            CASE 1
                TIMES SOURCE:SJOY_AMER, 0.90
                TIMES SOURCE:SPASSIVITY_AMER, 0.75
            CASE 2
                TIMES SOURCE:SJOY_AMER, 0.95
                TIMES SOURCE:SPASSIVITY_AMER, 0.90
            CASE 3
                ;TIMES SOURCE:SJOY_AMER, 1.00
                ;TIMES SOURCE:SPASSIVITY_AMER, 1.00
            CASE 4
                TIMES SOURCE:SJOY_AMER, 1.05
                TIMES SOURCE:SPASSIVITY_AMER, 1.10
            CASE 5
                TIMES SOURCE:SJOY_AMER, 1.15
                TIMES SOURCE:SPASSIVITY_AMER, 1.20
            CASE 6
                TIMES SOURCE:SJOY_AMER, 1.25
                TIMES SOURCE:SPASSIVITY_AMER, 1.30
        ENDSELECT
        CFLAG:AME36_COM_TRUST = 1
        IRREGULAR_TFLAG = 1
    ;--------------------------------------------------
    ;411 - 战斗训练 (60min)
    ;--------------------------------------------------
    CASE 411
        SOURCE:SJOY_AMER = 550
        SOURCE:SPASSIVITY_AMER = 150
        SOURCE:SCONQUEST_AMER = 100
        SOURCE:SSUBMISSION_AMER = 50
        ;--------------------------------------------------
        ;根据MASTER与阿燐的战斗能力之差乘算
        ;--------------------------------------------------
        SELECTCASE ABL:MASTER:POWER_AMER - ABL:POWER_AMER
            CASE IS < -1
                TIMES SOURCE:SJOY_AMER, 0.80
                TIMES SOURCE:SPASSIVITY_AMER, 0.10
                TIMES SOURCE:SCONQUEST_AMER, 3.00
                TIMES SOURCE:SSUBMISSION_AMER, 0.20
            CASE -1
                ;TIMES SOURCE:SJOY_AMER, 1.00
                TIMES SOURCE:SPASSIVITY_AMER, 0.50
                TIMES SOURCE:SCONQUEST_AMER, 1.50
                TIMES SOURCE:SSUBMISSION_AMER, 0.50
            CASE 0
                TIMES SOURCE:SJOY_AMER, 1.25
                ;TIMES SOURCE:SPASSIVITY_AMER, 1.00
                ;TIMES SOURCE:SCONQUEST_AMER, 1.00
                ;TIMES SOURCE:SSUBMISSION_AMER, 1.00
            CASE 1
                ;TIMES SOURCE:SJOY_AMER, 1.00
                TIMES SOURCE:SPASSIVITY_AMER, 1.50
                TIMES SOURCE:SCONQUEST_AMER, 0.50
                TIMES SOURCE:SSUBMISSION_AMER, 1.50
            CASE IS > 1
                TIMES SOURCE:SJOY_AMER, 0.80
                TIMES SOURCE:SPASSIVITY_AMER, 2.00
                TIMES SOURCE:SCONQUEST_AMER, 0.10
                TIMES SOURCE:SSUBMISSION_AMER, 3.00
        ENDSELECT
        CFLAG:AME36_COM_TRUST = 1
    ;--------------------------------------------------
    ;412 - 学习 (60min)
    ;--------------------------------------------------
    CASE 412
        SOURCE:SJOY_AMER = 500
        SOURCE:SPASSIVITY_AMER = 120
        SOURCE:SCONQUEST_AMER = 80
        ;--------------------------------------------------
        ;根据MASTER与阿燐的教养之差乘算
        ;--------------------------------------------------
        SELECTCASE ABL:MASTER:SCHOLARSHIP_AMER - ABL:SCHOLARSHIP_AMER
            CASE IS < -1
                TIMES SOURCE:SJOY_AMER, 0.80
                TIMES SOURCE:SPASSIVITY_AMER, 0.40
                TIMES SOURCE:SCONQUEST_AMER, 1.50
            CASE -1
                ;TIMES SOURCE:SJOY_AMER, 1.00
                TIMES SOURCE:SPASSIVITY_AMER, 0.75
                TIMES SOURCE:SCONQUEST_AMER, 1.25
            CASE 0
                TIMES SOURCE:SJOY_AMER, 1.25
                ;TIMES SOURCE:SPASSIVITY_AMER, 1.00
                ;TIMES SOURCE:SCONQUEST_AMER, 1.00
            CASE 1
                TIMES SOURCE:SJOY_AMER, 1.25
                TIMES SOURCE:SPASSIVITY_AMER, 1.25
                TIMES SOURCE:SCONQUEST_AMER, 0.50
            CASE IS > 1
                ;TIMES SOURCE:SJOY_AMER, 1.00
                TIMES SOURCE:SPASSIVITY_AMER, 1.50
                TIMES SOURCE:SCONQUEST_AMER, 0.20
        ENDSELECT
        CFLAG:AME36_COM_TRUST = 1
        IRREGULAR_TFLAG = 1
    ;--------------------------------------------------
    ;413 - 制作料理 (Dynamic)
    ;--------------------------------------------------
    CASE 413
        SOURCE:SJOY_AMER = 300
        SOURCE:SPASSIVITY_AMER = 100
        SOURCE:SCONQUEST_AMER = 60
        SOURCE:SACHIEVEMENT_AMER = 50
        ;--------------------------------------------------
        ;根据MASTER与阿燐的料理技能等级之差乘算
        ;--------------------------------------------------
        SELECTCASE ABL:MASTER:COOKERY_AMER - ABL:COOKERY_AMER
            CASE IS < -1
                ;TIMES SOURCE:SJOY_AMER, 1.00
                TIMES SOURCE:SPASSIVITY_AMER, 0.40
                TIMES SOURCE:SCONQUEST_AMER, 1.50
            CASE -1
                ;TIMES SOURCE:SJOY_AMER, 1.00
                TIMES SOURCE:SPASSIVITY_AMER, 0.75
                TIMES SOURCE:SCONQUEST_AMER, 1.25
            CASE 0
                TIMES SOURCE:SJOY_AMER, 1.25
                ;TIMES SOURCE:SPASSIVITY_AMER, 1.00
                ;TIMES SOURCE:SCONQUEST_AMER, 1.00
            CASE 1
                ;TIMES SOURCE:SJOY_AMER, 1.00
                TIMES SOURCE:SPASSIVITY_AMER, 1.25
                TIMES SOURCE:SCONQUEST_AMER, 0.50
            CASE IS > 1
                ;TIMES SOURCE:SJOY_AMER, 1.00
                TIMES SOURCE:SPASSIVITY_AMER, 1.50
                TIMES SOURCE:SCONQUEST_AMER, 0.20
        ENDSELECT
        CFLAG:AME36_COM_TRUST = 1
        IRREGULAR_TFLAG = 1
        CALL AME36_DISH_INDEX(DISH_NAME)
        TFLAG:193 = RESULT
        SIF RESULT:1
            TFLAG:193 += 1000
        ;--------------------------------------------------
        ;做过料理种类的记录
        ;--------------------------------------------------
        SELECTCASE RESULT
            CASE 101 TO 103
                SETBIT CFLAG:AME36_DISH_TYPE_1, RESULT - 101
            CASE 111 TO 119
                SETBIT CFLAG:AME36_DISH_TYPE_1, RESULT - 108
            CASE 121 TO 127
                SETBIT CFLAG:AME36_DISH_TYPE_1, RESULT - 109
            CASE 131 TO 146
                SETBIT CFLAG:AME36_DISH_TYPE_1, RESULT - 112
            CASE 151 TO 166
                SETBIT CFLAG:AME36_DISH_TYPE_1, RESULT - 116
            CASE 171 TO 174
                SETBIT CFLAG:AME36_DISH_TYPE_1, RESULT - 120
            CASE 181 TO 185
                SETBIT CFLAG:AME36_DISH_TYPE_1, RESULT - 126
            CASE 191 TO 194
                SETBIT CFLAG:AME36_DISH_TYPE_1, RESULT - 131
            CASE 195 TO 196
                SETBIT CFLAG:AME36_DISH_TYPE_2, RESULT - 195
            CASE 201 TO 221
                SETBIT CFLAG:AME36_DISH_TYPE_2, RESULT - 199
            CASE 231 TO 238
                SETBIT CFLAG:AME36_DISH_TYPE_2, RESULT - 208
            CASE 241 TO 251
                SETBIT CFLAG:AME36_DISH_TYPE_2, RESULT - 210
            CASE 261 TO 273
                SETBIT CFLAG:AME36_DISH_TYPE_2, RESULT - 219
            CASE 281 TO 287
                SETBIT CFLAG:AME36_DISH_TYPE_2, RESULT - 226
            CASE 291 TO 292
                SETBIT CFLAG:AME36_DISH_TYPE_2, RESULT - 229
            CASE 293 TO 295
                SETBIT CFLAG:AME36_DISH_TYPE_3, RESULT - 293
            CASE 301 TO 330
                SETBIT CFLAG:AME36_DISH_TYPE_3, RESULT - 298
            CASE 341 TO 343
                SETBIT CFLAG:AME36_DISH_TYPE_3, RESULT - 308
            CASE 351 TO 355
                SETBIT CFLAG:AME36_DISH_TYPE_3, RESULT - 315
            CASE 401 TO 464
                SETBIT CFLAG:AME36_DISH_TYPE_C1, RESULT - 401
            CASE 465 TO 528
                SETBIT CFLAG:AME36_DISH_TYPE_C2, RESULT - 465
            CASE 528 TO 400 + CHARANUM
                SETBIT CFLAG:AME36_DISH_TYPE_C3, RESULT - 528
        ENDSELECT
    ;--------------------------------------------------
    ;414, 415 - 吃饭/招待吃饭 (Dynamic)
    ;--------------------------------------------------
    CASE 414, 415
        SOURCE:SJOY_AMER = 200 * MAX(TCVAR:DISH_RATING_AMER - 300, 0) / 400
        SOURCE:SPASSIVITY_AMER = 75 + 50 * MAX(TCVAR:DISH_RATING_AMER - 300, 0) / 400
        CFLAG:AME36_COM_TRUST = 1
        ;--------------------------------------------------
        ;一点小饭才不会让阿燐心情不好
        ;--------------------------------------------------
        TALENT:MOOD_AMER = MAX(TALENT:MOOD_AMER, 0)
        IRREGULAR_TFLAG = 1
    ;--------------------------------------------------
    ;416 - 演奏 (30min)
    ;--------------------------------------------------
    CASE 416
        SOURCE:SJOY_AMER = 300
        SOURCE:SPASSIVITY_AMER = 100
        SOURCE:SCONQUEST_AMER = 100
        ;--------------------------------------------------
        ;根据MASTER的演奏技能等级乘算
        ;--------------------------------------------------
        SELECTCASE ABL:MASTER:VIRTUOSITY_AMER
            CASE 0
                TIMES SOURCE:SJOY_AMER, 0.10
                TIMES SOURCE:SPASSIVITY_AMER, 0.50
                TIMES SOURCE:SCONQUEST_AMER, 0.50
            CASE 1
                TIMES SOURCE:SJOY_AMER, 0.25
                TIMES SOURCE:SPASSIVITY_AMER, 0.75
                TIMES SOURCE:SCONQUEST_AMER, 0.75
            CASE 2
                TIMES SOURCE:SJOY_AMER, 0.50
                TIMES SOURCE:SPASSIVITY_AMER, 0.90
                TIMES SOURCE:SCONQUEST_AMER, 0.90
            CASE 3
                ;TIMES SOURCE:SJOY_AMER, 1.00
                ;TIMES SOURCE:SPASSIVITY_AMER, 1.00
                ;TIMES SOURCE:SCONQUEST_AMER, 1.00
            CASE 4
                TIMES SOURCE:SJOY_AMER, 1.10
                TIMES SOURCE:SPASSIVITY_AMER, 1.05
                TIMES SOURCE:SCONQUEST_AMER, 1.05
            CASE 5
                TIMES SOURCE:SJOY_AMER, 1.20
                TIMES SOURCE:SPASSIVITY_AMER, 1.10
                TIMES SOURCE:SCONQUEST_AMER, 1.10
            CASE 6
                TIMES SOURCE:SJOY_AMER, 1.30
                TIMES SOURCE:SPASSIVITY_AMER, 1.20
                TIMES SOURCE:SCONQUEST_AMER, 1.20
        ENDSELECT
        CFLAG:AME36_COM_TRUST = 1
    ;--------------------------------------------------
    ;417 - 午睡 (90min)
    ;--------------------------------------------------
    CASE 417
        ;--------------------------------------------------
        ;若不会被选为TARGET，则直接RETURN
        ;--------------------------------------------------
        SIF CFLAG:ATTITUDE_AMER == 0
            RETURN -1
        SOURCE:SJOY_AMER = 200
        SOURCE:SLOVE_AMER = 100
        SOURCE:SPASSIVITY_AMER = 100
        IRREGULAR_TFLAG = 1
    ;--------------------------------------------------
    ;431 - 在浴室里放松 (30min)
    ;--------------------------------------------------
    CASE 431
        ;--------------------------------------------------
        ;若不会被选为TARGET，则直接RETURN
        ;--------------------------------------------------
        SIF CFLAG:ATTITUDE_AMER == 0
            RETURN -1
        SOURCE:SJOY_AMER = 100
        SOURCE:SLOVE_AMER = 150
        IRREGULAR_TFLAG = 1
    ;--------------------------------------------------
    ;432 - 钱汤 (30min)
    ;--------------------------------------------------
    CASE 432
        ;--------------------------------------------------
        ;TFLAG:209 = 1：人里浴场；= 7：人里浴场的涤身之泉
        ;TFLAG:211 = 1：旧地狱温泉
        ;若不会被选为TARGET，则直接RETURN
        ;--------------------------------------------------
        IF TFLAG:209 == 1 || TFLAG:209 == 7
            SOURCE:SJOY_AMER = 100
        ELSEIF TFLAG:211 == 1
            SOURCE:SJOY_AMER = 150
            SOURCE:SLOVE_AMER = 150
        ELSE
            RETURN -1
        ENDIF
        IRREGULAR_TFLAG = 1
    ;--------------------------------------------------
    ;436 - 读书 (60min)
    ;--------------------------------------------------
    CASE 436
        ;--------------------------------------------------
        ;TFLAG:193：看的书编号，2为文学失败，3为文学成功，4为实用书失败，8为小黄书
        ;--------------------------------------------------
        SELECTCASE TFLAG:193
            CASE 2
                SOURCE:SJOY_AMER = 450
                SOURCE:SPASSIVITY_AMER = 150
            CASE 3
                SOURCE:SJOY_AMER = 500
                SOURCE:SPASSIVITY_AMER = 80
            CASE 4
                SOURCE:SJOY_AMER = 350
                SOURCE:SPASSIVITY_AMER = 150
            CASE 9
                SOURCE:SJOY_AMER = 200
                SOURCE:SLUST_AMER = 100
                SOURCE:SPASSIVITY_AMER = 150
            CASEELSE
                SOURCE:SJOY_AMER = 400
                SOURCE:SPASSIVITY_AMER = 100
        ENDSELECT
        CFLAG:AME36_COM_TRUST = 1
        IRREGULAR_TFLAG = 1
    ;--------------------------------------------------
    ;440 - 等待 (20min)
    ;--------------------------------------------------
    CASE 440
        ;--------------------------------------------------
        ;若不会被选为TARGET，则直接RETURN
        ;--------------------------------------------------
        SIF CFLAG:ATTITUDE_AMER == 0
            RETURN -1
        SOURCE:SJOY_AMER = 20
        SOURCE:SLOVE_AMER = 30
        IRREGULAR_TFLAG = 1
    ;--------------------------------------------------
    ;442 - 伐采 (Dynamic)
    ;WIP
    ;--------------------------------------------------
    CASE 442
        ;--------------------------------------------------
        ;若不会被选为TARGET，则直接RETURN
        ;--------------------------------------------------
        SIF ABL:INTIMACY_AMER < 10
            RETURN -1
        SOURCE:SJOY_AMER = 250
        SOURCE:SPASSIVITY_AMER = 100
        SOURCE:SCONQUEST_AMER = 150
        CFLAG:AME36_COM_TRUST = 1
        IRREGULAR_TFLAG = 1
    ;--------------------------------------------------
    ;445 - 采集 (60min)
    ;--------------------------------------------------
    CASE 445
        ;--------------------------------------------------
        ;若不会被选为TARGET，则直接RETURN
        ;--------------------------------------------------
        SIF ABL:INTIMACY_AMER < 5 || CFLAG:ACTION_AMER == 5
            RETURN -1
        SELECTCASE ITEMPRICE:(TFLAG:193)
            CASE 1 TO 1000
                SOURCE:SJOY_AMER = 400
                SOURCE:SPASSIVITY_AMER = 50
                ;SOURCE:SCONQUEST_AMER = 0
                ;SOURCE:SACHIEVEMENT_AMER = 0
            CASE 1001 TO 3000
                SOURCE:SJOY_AMER = 400
                SOURCE:SPASSIVITY_AMER = 100
                SOURCE:SCONQUEST_AMER = 100
                SOURCE:SACHIEVEMENT_AMER = 50
            CASE 3000 TO 10000
                SOURCE:SJOY_AMER = 400
                SOURCE:SPASSIVITY_AMER = 150
                SOURCE:SCONQUEST_AMER = 200
                SOURCE:SACHIEVEMENT_AMER = 100
            CASEELSE
                SOURCE:SJOY_AMER = 400
                SOURCE:SPASSIVITY_AMER = 200
                SOURCE:SCONQUEST_AMER = 300
                SOURCE:SACHIEVEMENT_AMER = 200
        ENDSELECT
        CFLAG:AME36_COM_TRUST = 1
        IRREGULAR_TFLAG = 1
    ;--------------------------------------------------
    ;446 - 进行调合 (Dynamic)
    ;--------------------------------------------------
    CASE 446
        ;--------------------------------------------------
        ;若不会被选为TARGET，则直接RETURN
        ;--------------------------------------------------
        SIF ABL:INTIMACY_AMER < 5 || CFLAG:ACTION_AMER == 5
            RETURN -1
        IF TFLAG:193
            ;--------------------------------------------------
            ;根据所调合出物品的等阶乘算
            ;1-5级分别需要30/40/50/65/80min
            ;--------------------------------------------------
            SELECTCASE PHARMACY_RANK(TFLAG:193)
                CASE 1
                    SOURCE:SJOY_AMER = 200
                    SOURCE:SPASSIVITY_AMER = 100
                    SOURCE:SCONQUEST_AMER = 20
                    SOURCE:SACHIEVEMENT_AMER = 50
                CASE 2
                    SOURCE:SJOY_AMER = 300
                    SOURCE:SPASSIVITY_AMER = 150
                    SOURCE:SCONQUEST_AMER = 50
                    SOURCE:SACHIEVEMENT_AMER = 100
                CASE 3
                    SOURCE:SJOY_AMER = 400
                    SOURCE:SPASSIVITY_AMER = 200
                    SOURCE:SCONQUEST_AMER = 100
                    SOURCE:SACHIEVEMENT_AMER = 150
                CASE 4
                    SOURCE:SJOY_AMER = 500
                    SOURCE:SPASSIVITY_AMER = 250
                    SOURCE:SCONQUEST_AMER = 200
                    SOURCE:SACHIEVEMENT_AMER = 250
                CASE 5
                    SOURCE:SJOY_AMER = 700
                    SOURCE:SPASSIVITY_AMER = 350
                    SOURCE:SCONQUEST_AMER = 350
                    SOURCE:SACHIEVEMENT_AMER = 350
            ENDSELECT
            ;--------------------------------------------------
            ;根据所调合出物品的数量乘算
            ;--------------------------------------------------
            SELECTCASE TFLAG:194 / RECIPE_DATA(TFLAG:193, 6)
                CASE 1
                    LOCAL = 10
                CASE 2
                    LOCAL = 13
                CASE 3
                    LOCAL = 15
                CASE 4
                    LOCAL = 17
                CASE 5
                    LOCAL = 19
                CASE 6
                    LOCAL = 20
                CASE 7
                    LOCAL = 22
                CASE 8
                    LOCAL = 23
                CASE 9
                    LOCAL = 24
                CASE 10
                    LOCAL = 25
            ENDSELECT
            SOURCE:SJOY_AMER = SOURCE:SJOY_AMER * LOCAL / 10
            SOURCE:SPASSIVITY_AMER = SOURCE:SPASSIVITY_AMER * LOCAL / 10
            SOURCE:SCONQUEST_AMER = SOURCE:SCONQUEST_AMER * LOCAL / 10
            SOURCE:SACHIEVEMENT_AMER = SOURCE:SACHIEVEMENT_AMER * LOCAL / 10
            VARSET LOCAL
        ELSE
            SOURCE:SJOY_AMER = 150
            SOURCE:SPASSIVITY_AMER = 50
        ENDIF
        CFLAG:AME36_COM_TRUST = 1
        IRREGULAR_TFLAG = 1
    ;--------------------------------------------------
    ;447 - 路边摆摊 (120min)
    ;--------------------------------------------------
    CASE 447
        ;--------------------------------------------------
        ;若不会被选为TARGET，则直接RETURN
        ;--------------------------------------------------
        SIF ABL:INTIMACY_AMER < 10 || CFLAG:ACTION_AMER == 5
            RETURN -1
        ;--------------------------------------------------
        ;根据销售额乘算
        ;--------------------------------------------------
        SELECTCASE TFLAG:194
            CASE 0
                SOURCE:SJOY_AMER = 400
                SOURCE:SPASSIVITY_AMER = 75
                ;SOURCE:SCONQUEST_AMER = 0
                ;SOURCE:SACHIEVEMENT_AMER = 0
            CASE 1 TO 2000
                SOURCE:SJOY_AMER = 500
                SOURCE:SPASSIVITY_AMER = 100
                SOURCE:SCONQUEST_AMER = 100
                SOURCE:SACHIEVEMENT_AMER = 100
            CASE 2001 TO 5000
                SOURCE:SJOY_AMER = 600
                SOURCE:SPASSIVITY_AMER = 150
                SOURCE:SCONQUEST_AMER = 200
                SOURCE:SACHIEVEMENT_AMER = 150
            CASE 5001 TO 20000
                SOURCE:SJOY_AMER = 750
                SOURCE:SPASSIVITY_AMER = 200
                SOURCE:SCONQUEST_AMER = 300
                SOURCE:SACHIEVEMENT_AMER = 200
            CASE 20001 TO 50000
                SOURCE:SJOY_AMER = 900
                SOURCE:SPASSIVITY_AMER = 300
                SOURCE:SCONQUEST_AMER = 400
                SOURCE:SACHIEVEMENT_AMER = 300
            CASEELSE
                SOURCE:SJOY_AMER = 1200
                SOURCE:SPASSIVITY_AMER = 400
                SOURCE:SCONQUEST_AMER = 600
                SOURCE:SACHIEVEMENT_AMER = 400
        ENDSELECT
        CFLAG:AME36_COM_TRUST = 1
        IRREGULAR_TFLAG = 1
    ;--------------------------------------------------
    ;448 - 设下陷阱 (Dynamic)
    ;--------------------------------------------------
    CASE 448
        ;--------------------------------------------------
        ;若不会被选为TARGET，则直接RETURN
        ;--------------------------------------------------
        SIF ABL:INTIMACY_AMER < 10 || CFLAG:ACTION_AMER == 5 || TFLAG:194 == 0
            RETURN -1
        ;--------------------------------------------------
        ;根据捕获猎物的种类乘算
        ;TFLAG:193 = -1：陷阱坏掉了；= 0：设下了陷阱；= 1：捕获了猎物
        ;TFLAG:194 = 23：死亡蠕虫；= 19：亚洲黑熊
        ;--------------------------------------------------
        SELECTCASE TFLAG:193
            CASE -1
                SOURCE:SPASSIVITY_AMER = 200
            CASE 0
                SOURCE:SJOY_AMER = 200
                SOURCE:SPASSIVITY_AMER = 50
            CASE 1
                IF TFLAG:194 == 23
    	    		SOURCE:SJOY_AMER = 300
                    SOURCE:SPASSIVITY_AMER = 100
                    SOURCE:SCONQUEST_AMER = 300
                    SOURCE:SACHIEVEMENT_AMER = 300
        		ELSEIF STRCOUNT(CritterTribe, "希少/")
        			SOURCE:SJOY_AMER = 400
                    SOURCE:SPASSIVITY_AMER = 150
                    SOURCE:SCONQUEST_AMER = 350
                    SOURCE:SACHIEVEMENT_AMER = 350
        		ELSEIF TFLAG:194 == 19
        			SOURCE:SJOY_AMER = 350
                    SOURCE:SPASSIVITY_AMER = 150
                    SOURCE:SCONQUEST_AMER = 350
                    SOURCE:SACHIEVEMENT_AMER = 350
        		ELSEIF STRCOUNT(CritterTribe, "謎/")
        			SOURCE:SJOY_AMER = 150
                    SOURCE:SPASSIVITY_AMER = 50
                    SOURCE:SCONQUEST_AMER = 50
                    SOURCE:SACHIEVEMENT_AMER = 50
        		ELSEIF STRCOUNT(CritterTribe, "小型/")
        			SOURCE:SJOY_AMER = 200
                    SOURCE:SPASSIVITY_AMER = 75
                    SOURCE:SCONQUEST_AMER = 100
                    SOURCE:SACHIEVEMENT_AMER = 100
        		ELSEIF STRCOUNT(CritterTribe, "中型/")
        			SOURCE:SJOY_AMER = 250
                    SOURCE:SPASSIVITY_AMER = 100
                    SOURCE:SCONQUEST_AMER = 150
                    SOURCE:SACHIEVEMENT_AMER = 150
        		ELSEIF STRCOUNT(CritterTribe, "大型/")
        			SOURCE:SJOY_AMER = 300
                    SOURCE:SPASSIVITY_AMER = 150
                    SOURCE:SCONQUEST_AMER = 250
                    SOURCE:SACHIEVEMENT_AMER = 250
    		ENDIF
        ENDSELECT
        CFLAG:AME36_COM_TRUST = 1
        IRREGULAR_TFLAG = 1
    ;--------------------------------------------------
    ;449 - 捕虫 (40min)
    ;--------------------------------------------------
    CASE 449
        ;--------------------------------------------------
        ;若不会被选为TARGET，则直接RETURN
        ;--------------------------------------------------
        SIF ABL:INTIMACY_AMER < 5 - TALENT:GATHERING_AMER || CFLAG:ACTION_AMER == 5
            RETURN -1
        ;--------------------------------------------------
        ;根据选项差分进行赋值
        ;TFLAG:193 =-2：阿燐捕到虫，选择「即使杀了你、也要得到它」（你还有心嘛？？？）
        ;          =-1：阿燐捕到虫，MASTER索要未果
        ;          = 0：什么都没有捕到
        ;          = 1：MASTER捕到虫
        ;          = 2：阿燐捕到虫，没有被索要
        ;          = 3：阿燐捕到虫，MASTER索要，不乐意地给了
        ;          = 4：阿燐捕到虫，MASTER索要，欣然给了
        ;--------------------------------------------------
        SELECTCASE TFLAG:193
            CASE -2
                SOURCE:SHATE_AMER = 100
                RETURN -1
            CASE -1
                SOURCE:SJOY_AMER = 100
                SOURCE:SPASSIVITY_AMER = 150
            CASE 0
                SOURCE:SJOY_AMER = 250
                SOURCE:SPASSIVITY_AMER = 100
            CASEELSE
                SELECTCASE TFLAG:193
                    CASE 1, 2
                        SOURCE:SJOY_AMER = 300
                        SOURCE:SPASSIVITY_AMER = 100
                        SOURCE:SACHIEVEMENT_AMER = 50
                    CASE 3, 4
                        SOURCE:SJOY_AMER = 250
                        SOURCE:SPASSIVITY_AMER = 150
                        SOURCE:SACHIEVEMENT_AMER = 50
                ENDSELECT
                ;--------------------------------------------------
                ;根据捕获虫的等阶乘算
                ;--------------------------------------------------
                SELECTCASE MUSHI_RARE
                    CASE 8, 9
                        TIMES SOURCE:SJOY_AMER, 2.00
                        TIMES SOURCE:SACHIEVEMENT_AMER, 4.00
                    CASE 5, 6, 7
                        TIMES SOURCE:SJOY_AMER, 1.50
                        TIMES SOURCE:SACHIEVEMENT_AMER, 2.00
                ENDSELECT
        ENDSELECT
        CFLAG:AME36_COM_TRUST = 1
        IRREGULAR_TFLAG = 1
    ;--------------------------------------------------
    ;480 - 弹幕胜负 (60min)
    ;先这样放着罢、到时候写弹幕胜负的时候再说
    ;--------------------------------------------------
    CASE 480
        SOURCE:SJOY_AMER = 800
        CFLAG:AME36_COM_TRUST = 1
        IRREGULAR_TFLAG = 1
    ;--------------------------------------------------
    ;483 - 斗虫 (60min)
    ;--------------------------------------------------
    CASE 483
        ;--------------------------------------------------
        ;TFLAG:193 = 1：决斗；= 2：乱斗；= 3：团队战
        ;TCVAR:MUSHI_TRACK_AMER % 10：阿燐的名次
        ;--------------------------------------------------
        SELECTCASE TFLAG:193
            CASE 1
                IF TCVAR:MUSHI_TRACK_AMER % 10 == 1
                    SOURCE:SJOY_AMER = 550
                    SOURCE:SPASSIVITY_AMER = 100
                    SOURCE:SCONQUEST_AMER = 250
                    SOURCE:SACHIEVEMENT_AMER = 200
                ELSE
                    SOURCE:SJOY_AMER = 450
                    SOURCE:SPASSIVITY_AMER = 200
                ENDIF
            CASE 2
                SELECTCASE TCVAR:MUSHI_TRACK_AMER % 10
                    CASE 1
                        SOURCE:SJOY_AMER = 700
                        SOURCE:SPASSIVITY_AMER = 50
                        SOURCE:SCONQUEST_AMER = 300
                        SOURCE:SACHIEVEMENT_AMER = 250
                    CASE 2
                        SOURCE:SJOY_AMER = 600
                        SOURCE:SPASSIVITY_AMER = 100
                        SOURCE:SCONQUEST_AMER = 100
                        SOURCE:SACHIEVEMENT_AMER = 50
                    CASE 3
                        SOURCE:SJOY_AMER = 550
                        SOURCE:SPASSIVITY_AMER = 150
                        SOURCE:SCONQUEST_AMER = 20
                    CASEELSE
                        SOURCE:SJOY_AMER = 500
                        SOURCE:SPASSIVITY_AMER = 150
                ENDSELECT
            CASE 3
                IF TCVAR:MUSHI_TRACK_AMER % 10 == 1
                    SOURCE:SJOY_AMER = 700
                    SOURCE:SPASSIVITY_AMER = 100
                    SOURCE:SCONQUEST_AMER = 300
                    SOURCE:SACHIEVEMENT_AMER = 250
                ELSE
                    SOURCE:SJOY_AMER = 550
                    SOURCE:SPASSIVITY_AMER = 200
                ENDIF
        ENDSELECT
        CFLAG:AME36_COM_TRUST = 1
        IRREGULAR_TFLAG = 1
    ;--------------------------------------------------
    ;484 - 打西瓜 (60min)
    ;TFLAG:193 =-1：没有打到
    ;          = 0：勉强打到了（距离1步）
    ;          = 1：正中西瓜
    ;          = 2：使用木刀正中西瓜
    ;--------------------------------------------------
    CASE 484
        SELECTCASE TFLAG:193
            CASE -1, 0
                SOURCE:SJOY_AMER = 400
                SOURCE:SPASSIVITY_AMER = 100
            CASE 1
                SOURCE:SJOY_AMER = 500
                SOURCE:SPASSIVITY_AMER = 150
            CASE 2
                SOURCE:SJOY_AMER = 600
                SOURCE:SPASSIVITY_AMER = 200
        ENDSELECT
        IRREGULAR_TFLAG = 1
    ;--------------------------------------------------
    ;603 - 牵手 (10min)
    ;--------------------------------------------------
    CASE 603
        SOURCE:SJOY_AMER = 80
        SOURCE:SLOVE_AMER = 60
        SOURCE:SPASSIVITY_AMER = 60
    ;--------------------------------------------------
    ;605 - 绕道 (10min)
    ;--------------------------------------------------
    CASE 605
        SOURCE:SJOY_AMER = 100
        SOURCE:SLOVE_AMER = 80
        SOURCE:SPASSIVITY_AMER = 80
    ;--------------------------------------------------
    ;610 - 请吃饭 (60min)
    ;--------------------------------------------------
    CASE 610
        SOURCE:SJOY_AMER = 550
        SOURCE:SLOVE_AMER = 300
        SOURCE:SPASSIVITY_AMER = 250
        SOURCE:SCONQUEST_AMER = 200
        CFLAG:AME36_COM_TRUST = 1
    ;--------------------------------------------------
    ;614 - 采购食材 (30min)
    ;--------------------------------------------------
    CASE 614
        SOURCE:SJOY_AMER = 250
        SOURCE:SPASSIVITY_AMER = 100
        CFLAG:AME36_COM_TRUST = 1
    ;--------------------------------------------------
    ;615 - 吃便当 (60min)
    ;--------------------------------------------------
    CASE 615
        SOURCE:SJOY_AMER = 300
        SOURCE:SLOVE_AMER = 400
        SOURCE:SCONQUEST_AMER = 100
        SOURCE:SACHIEVEMENT_AMER = 300
    ;--------------------------------------------------
    ;617 - 邀请去甜品店 (60min)
    ;--------------------------------------------------
    CASE 617
        SOURCE:SJOY_AMER = 600
        SOURCE:SLOVE_AMER = 350
        SOURCE:SPASSIVITY_AMER = 300
        SOURCE:SCONQUEST_AMER = 200
        CFLAG:AME36_COM_TRUST = 1
    ;--------------------------------------------------
    ;621 - 钓鱼 (20min)
    ;TFLAG:193：钓到物品的编号
    ;TFLAG:194 / 1000 = 0：MASTER钓到；= 1：阿燐钓到
    ;--------------------------------------------------
    CASE 621
        SIF ABL:INTIMACY_AMER < 5 - TALENT:FISHING_AMER || CFLAG:ACTION_AMER == 5
            RETURN -1
        IF TFLAG:194 / 1000
            SELECTCASE TFLAG:193
                ;--------------------------------------------------
                ;木材和守矢神签
                ;--------------------------------------------------
                CASE 131, 610
                    SOURCE:SJOY_AMER = 120
                    SOURCE:SPASSIVITY_AMER = 120
                ;--------------------------------------------------
                ;好吃的鱼
                ;--------------------------------------------------
                CASE 11 TO 20, 24 TO 30, 32
                    SOURCE:SJOY_AMER = 250
                    SOURCE:SPASSIVITY_AMER = 50
                    SOURCE:SCONQUEST_AMER = 100
                    SOURCE:SACHIEVEMENT_AMER = 150
                ;--------------------------------------------------
                ;跳蛋
                ;--------------------------------------------------
                CASE 21
                    SOURCE:SJOY_AMER = 150
                    SOURCE:SLUST_AMER = 100
                    SOURCE:SPASSIVITY_AMER = 200
                ;--------------------------------------------------
                ;很厉害的东西
                ;--------------------------------------------------
                CASE 23, 31, 606, 609, 643
                    SOURCE:SJOY_AMER = 350
                    SOURCE:SCONQUEST_AMER = 150
                    SOURCE:SACHIEVEMENT_AMER = 250
                CASEELSE
                    SOURCE:SJOY_AMER = 200
                    SOURCE:SPASSIVITY_AMER = 80
                    SOURCE:SCONQUEST_AMER = 20
                    SOURCE:SACHIEVEMENT_AMER = 100
            ENDSELECT
        ELSE
            SOURCE:SJOY_AMER = 200
            SOURCE:SPASSIVITY_AMER = 150
        ENDIF
        IF TFLAG:193 == 0
            SOURCE:SJOY_AMER = 150
            SOURCE:SPASSIVITY_AMER = 150
        ENDIF
        CFLAG:AME36_COM_TRUST = 1
        IRREGULAR_TFLAG = 1
    ;--------------------------------------------------
    ;626 - 土产屋 (10+nmin)
    ;--------------------------------------------------
    CASE 626
        SELECTCASE TFLAG:193
            CASE IS < 0
                SOURCE:SJOY_AMER = 100
                SOURCE:SPASSIVITY_AMER = 50
            CASE 1 TO 6
                SOURCE:SJOY_AMER = TFLAG:193 * 75
                SOURCE:SPASSIVITY_AMER = TFLAG:193 * 30
            CASE IS > 7
                SOURCE:SJOY_AMER = TFLAG:193 * 125 - 300
                SOURCE:SPASSIVITY_AMER = TFLAG:193 * 100 - 300
                CFLAG:AME36_COM_TRUST = 1
        ENDSELECT
        IRREGULAR_TFLAG = 1
ENDSELECT
;--------------------------------------------------
;根据TFLAG:193分歧对SOURCE进行乘算
;--------------------------------------------------
IF !IRREGULAR_TFLAG
    SELECTCASE TFLAG:193
        CASE IS < 0
            TIMES SOURCE:SJOY_AMER, 0.70
            TIMES SOURCE:SLOVE_AMER, 0.50
            TIMES SOURCE:SLUST_AMER, 0.30
            TIMES SOURCE:SPASSIVITY_AMER, 0.50
            TIMES SOURCE:SCONQUEST_AMER, 0.20
            TIMES SOURCE:SACHIEVEMENT_AMER, 0.20
            TIMES SOURCE:SSUBMISSION_AMER, 0.30
        CASE IS > 0
            TIMES SOURCE:SJOY_AMER, 1.20
            TIMES SOURCE:SLOVE_AMER, 1.50
            TIMES SOURCE:SLUST_AMER, 1.20
            TIMES SOURCE:SPASSIVITY_AMER, 1.20
            TIMES SOURCE:SCONQUEST_AMER, 1.50
            TIMES SOURCE:SACHIEVEMENT_AMER, 1.50
            TIMES SOURCE:SSUBMISSION_AMER, 1.20
    ENDSELECT
ENDIF
;--------------------------------------------------
;好感和信赖初始增加值的计算
;出于精度考虑，暂且控制为10倍
;--------------------------------------------------
{
CFLAG:AME36_COM_FAVOR = 
    SOURCE:SJOY_AMER / 15 +
    SOURCE:SLOVE_AMER / 15 +
    SOURCE:SLUST_AMER / 15 +
    SOURCE:SPASSIVITY_AMER / 30 +
    SOURCE:SCONQUEST_AMER / 30 +
    SOURCE:SACHIEVEMENT_AMER / 30 +
    SOURCE:SSUBMISSION_AMER / 20
}
IF CFLAG:AME36_COM_TRUST
    {
    CFLAG:AME36_COM_TRUST = 
        SOURCE:SJOY_AMER / 30 +
        SOURCE:SPASSIVITY_AMER / 30 +
        SOURCE:SACHIEVEMENT_AMER / 20 +
        SOURCE:SSUBMISSION_AMER / 20
    }
ENDIF
;PRINTFORML 1.{CFLAG:AME36_COM_TRUST}
;--------------------------------------------------
;根据回忆值进行乘算
;倍率：1.5 - 3 - 5 - 8 - 8*
;--------------------------------------------------
VARSET LOCAL
LOCAL = AME36_EFFECTIVE_RECOLLECTION()
IF LOCAL < AME36_RECOLLECTION1
    LOCAL:1 = 1000 + 500 * LOCAL / AME36_RECOLLECTION1
ELSEIF LOCAL < AME36_RECOLLECTION2
    LOCAL:1 = 1500 + 1500 * (LOCAL - AME36_RECOLLECTION1) / (AME36_RECOLLECTION2 - AME36_RECOLLECTION1)
ELSEIF LOCAL < AME36_RECOLLECTION3
    LOCAL:1 = 3000 + 2000 * (LOCAL - AME36_RECOLLECTION2) / (AME36_RECOLLECTION3 - AME36_RECOLLECTION2)
ELSEIF LOCAL < AME36_RECOLLECTION4
    LOCAL:1 = 5000 + 3000 * (LOCAL - AME36_RECOLLECTION3) / (AME36_RECOLLECTION4 - AME36_RECOLLECTION3)
ELSE
    LOCAL:1 = 8000 + 8000 * (LOCAL - AME36_RECOLLECTION4) / (AME36_RECOLLECTION4 - AME36_RECOLLECTION3)
ENDIF
CFLAG:AME36_COM_FAVOR = CFLAG:AME36_COM_FAVOR * LOCAL:1 / 1000
CFLAG:AME36_COM_TRUST = CFLAG:AME36_COM_TRUST * LOCAL:1 / 1000
;PRINTFORML 2.{CFLAG:AME36_COM_TRUST}
;--------------------------------------------------
;根据回忆值进行SOURCE的乘算，倍率如下
;欢乐：2 - 5 - 10 - 20 - 20*
;情爱：0 - 2 - 6 - 15 - 20*
;欲情：0 - 0 - 3 - 10 - 25*
;受动：1.5 - 3 - 5 - 8 - 8*
;征服：1.5 - 3 - 5 - 8 - 8*
;达成：1.5 - 3 - 5 - 8 - 8*
;屈从：1.5 - 3 - 5 - 8 - 8*
;--------------------------------------------------
IF LOCAL < AME36_RECOLLECTION1
    LOCAL:2 = 1000 + 1000 * LOCAL / AME36_RECOLLECTION1
    ;LOCAL:3 = 0
    ;LOCAL:4 = 0
ELSEIF LOCAL < AME36_RECOLLECTION2
    LOCAL:2 = 2000 + 3000 * (LOCAL - AME36_RECOLLECTION1) / (AME36_RECOLLECTION2 - AME36_RECOLLECTION1)
    LOCAL:3 = 2000 * (LOCAL - AME36_RECOLLECTION1) / (AME36_RECOLLECTION2 - AME36_RECOLLECTION1)
    ;LOCAL:4 = 0
ELSEIF LOCAL < AME36_RECOLLECTION3
    LOCAL:2 = 5000 + 5000 * (LOCAL - AME36_RECOLLECTION2) / (AME36_RECOLLECTION3 - AME36_RECOLLECTION2)
    LOCAL:3 = 2000 + 4000 * (LOCAL - AME36_RECOLLECTION2) / (AME36_RECOLLECTION3 - AME36_RECOLLECTION2)
    LOCAL:4 = 3000 * (LOCAL - AME36_RECOLLECTION2) / (AME36_RECOLLECTION3 - AME36_RECOLLECTION2)
ELSEIF LOCAL < AME36_RECOLLECTION4
    LOCAL:2 = 10000 + 10000 * (LOCAL - AME36_RECOLLECTION3) / (AME36_RECOLLECTION4 - AME36_RECOLLECTION3)
    LOCAL:3 = 6000 + 9000 * (LOCAL - AME36_RECOLLECTION3) / (AME36_RECOLLECTION4 - AME36_RECOLLECTION3)
    LOCAL:4 = 3000 + 7000 * (LOCAL - AME36_RECOLLECTION3) / (AME36_RECOLLECTION4 - AME36_RECOLLECTION3)
ELSE
    LOCAL:2 = 20000 + 20000 * (LOCAL - AME36_RECOLLECTION4) / (AME36_RECOLLECTION4 - AME36_RECOLLECTION3)
    LOCAL:3 = 15000 + 20000 * (LOCAL - AME36_RECOLLECTION4) / (AME36_RECOLLECTION4 - AME36_RECOLLECTION3)
    LOCAL:4 = 10000 + 25000 * (LOCAL - AME36_RECOLLECTION4) / (AME36_RECOLLECTION4 - AME36_RECOLLECTION3)
ENDIF
SOURCE:SJOY_AMER = SOURCE:SJOY_AMER * LOCAL:2 / 1000
SOURCE:SLOVE_AMER = SOURCE:SLOVE_AMER * LOCAL:3 / 1000
SOURCE:SLUST_AMER = SOURCE:SLUST_AMER * LOCAL:4 / 1000
SOURCE:SPASSIVITY_AMER = SOURCE:SPASSIVITY_AMER * LOCAL:1 / 1000
SOURCE:SCONQUEST_AMER = SOURCE:SCONQUEST_AMER * LOCAL:1 / 1000
SOURCE:SACHIEVEMENT_AMER = SOURCE:SACHIEVEMENT_AMER * LOCAL:1 / 1000
SOURCE:SSUBMISSION_AMER = SOURCE:SSUBMISSION_AMER * LOCAL:1 / 1000
;--------------------------------------------------
;反制MASTER_FAVOR_CHECK和TECHNIQUE_CHECK
;--------------------------------------------------
SOURCE:SJOY_AMER = SOURCE:SJOY_AMER * 10000 / MASTER_FAVOR_CHECK(36, SJOY_AMER) / TECHNIQUE_CHECK(36, SJOY_AMER)
SOURCE:SLOVE_AMER = SOURCE:SLOVE_AMER * 10000 / MASTER_FAVOR_CHECK(36, SLOVE_AMER) / TECHNIQUE_CHECK(36, SLOVE_AMER)
SOURCE:SLUST_AMER = SOURCE:SLUST_AMER * 10000 / MASTER_FAVOR_CHECK(36, SLUST_AMER) / TECHNIQUE_CHECK(36, SLUST_AMER)
SOURCE:SPASSIVITY_AMER = SOURCE:SPASSIVITY_AMER * 10000 / MASTER_FAVOR_CHECK(36, SPASSIVITY_AMER) / TECHNIQUE_CHECK(36, SPASSIVITY_AMER)
SOURCE:SCONQUEST_AMER = SOURCE:SCONQUEST_AMER * 10000 / MASTER_FAVOR_CHECK(36, SCONQUEST_AMER) / TECHNIQUE_CHECK(36, SCONQUEST_AMER)
SOURCE:SACHIEVEMENT_AMER = SOURCE:SACHIEVEMENT_AMER * 10000 / MASTER_FAVOR_CHECK(36, SACHIEVEMENT_AMER) / TECHNIQUE_CHECK(36, SACHIEVEMENT_AMER)
SOURCE:SSUBMISSION_AMER = SOURCE:SSUBMISSION_AMER * 10000 / MASTER_FAVOR_CHECK(36, SSUBMISSION_AMER) / TECHNIQUE_CHECK(36, SSUBMISSION_AMER)
;--------------------------------------------------
;随当天执行次数效应递减
;--------------------------------------------------
COM_EQUIVALENT = UNIFIED_COM
SIF UNIFIED_COM == 336 || UNIFIED_COM == 1060
    COM_EQUIVALENT = 305
SIF UNIFIED_COM == 415
    COM_EQUIVALENT = 414
SIF UNIFIED_COM == 1061
    COM_EQUIVALENT = 402
SIF UNIFIED_COM == 1062
    COM_EQUIVALENT = 309
SIF UNIFIED_COM == 1080
    COM_EQUIVALENT = 603
IF COM_EQUIVALENT >= 300 && COM_EQUIVALENT < 800
    ;--------------------------------------------------
    ;当阿燐很讨厌你做的事情时，什么都不获得，并清空正面SOURCE
    ;--------------------------------------------------
    IF CFLAG:AME36_NO_RECOLLECTION_THIS_TIME
        CALL AME36_TIMES_RELAVENT_SOURCE(0)
        RETURN -1
    ENDIF
    AME36_COM_COUNTER:(COM_EQUIVALENT - 300) += 1
    SELECTCASE COM_EQUIVALENT
        ;--------------------------------------------------
        ;衰减最快：330掀起裙子、333听牢骚、354陪睡、417午睡、480弹幕胜负、483斗虫、484打西瓜、610请吃饭、614采购食材、
        ;615吃便当、617邀请去甜品店
        ;--------------------------------------------------
        CASE 330, 333, 354, 417, 480, 483, 484, 610, 614, 615, 617
            SELECTCASE AME36_COM_COUNTER:(COM_EQUIVALENT - 300)
                CASE 1
                    PERCENTAGE_DUPE = 100
                    CFLAG:AME36_ATTENTION += 2
                    EXP_ADD = 1
                CASE 2
                    PERCENTAGE_DUPE = 10
                    EXP_ADD = -2
                CASE IS >= 3
                    PERCENTAGE_DUPE = 5
                    EXP_ADD = -3
            ENDSELECT
            MONO = 1
        ;--------------------------------------------------
        ;衰减快：301泡茶、305膝枕/索求膝枕、306抚摸小腹、307捏脸蛋、308戳脸颊、309摸头、310摸屁股、311拥抱、332劝酒、
        ;403休憩、410扫除、414吃饭/招待吃饭、416演奏、431在浴室里放松、432钱汤、440等待、447路边摆摊、605绕道
        ;--------------------------------------------------
        CASE 301, 305, 306, 307, 308, 309, 310, 311, 332, 403, 410, 414, 416, 431, 432, 440, 447, 605
            SELECTCASE AME36_COM_COUNTER:(COM_EQUIVALENT - 300)
                CASE 1
                    PERCENTAGE_DUPE = 100
                    CFLAG:AME36_ATTENTION += 2
                    EXP_ADD = 2
                CASE 2
                    PERCENTAGE_DUPE = 60
                    CFLAG:AME36_ATTENTION += 2
                    EXP_ADD = 1
                CASE 3
                    PERCENTAGE_DUPE = 30
                    CFLAG:AME36_ATTENTION ++
                    EXP_ADD = 1
                CASE 4 TO 5
                    PERCENTAGE_DUPE = 10
                CASE 6 TO 9
                    PERCENTAGE_DUPE = 7
                    EXP_ADD = -1
                CASE IS >= 10
                    PERCENTAGE_DUPE = 5
                    EXP_ADD = -2
            ENDSELECT
        ;--------------------------------------------------
        ;衰减慢：300会话、302身体接触、334碰杯、413制作料理、436读书、442伐采、445采集、446进行调合、448设下陷阱、
        ;449捕虫、621钓鱼
        ;--------------------------------------------------
        CASE 300, 302, 334, 413, 436, 442, 445, 446, 448, 449, 621
            SELECTCASE AME36_COM_COUNTER:(COM_EQUIVALENT - 300)
                CASE 1
                    PERCENTAGE_DUPE = 100
                    CFLAG:AME36_ATTENTION += 2
                    EXP_ADD = 2
                CASE 2
                    PERCENTAGE_DUPE = 80
                    CFLAG:AME36_ATTENTION += 2
                    EXP_ADD = 2
                CASE 3
                    PERCENTAGE_DUPE = 65
                    CFLAG:AME36_ATTENTION += 2
                    EXP_ADD = 1
                CASE 4
                    PERCENTAGE_DUPE = 55
                    CFLAG:AME36_ATTENTION += 2
                    EXP_ADD = 1
                CASE 5
                    PERCENTAGE_DUPE = 45
                    CFLAG:AME36_ATTENTION ++
                    EXP_ADD = 1
                CASE 6
                    PERCENTAGE_DUPE = 35
                    CFLAG:AME36_ATTENTION ++
                CASE 7
                    PERCENTAGE_DUPE = 30
                    CFLAG:AME36_ATTENTION ++
                CASE 8
                    PERCENTAGE_DUPE = 25
                    CFLAG:AME36_ATTENTION ++
                CASE 9 TO 15
                    PERCENTAGE_DUPE = 20
                    EXP_ADD = -1
                CASE IS >= 16
                    PERCENTAGE_DUPE = 15
                    EXP_ADD = -2
            ENDSELECT
        ;--------------------------------------------------
        ;衰减最慢：304帮忙干活、411战斗训练、412学习、603牵手
        ;理论上牵手不应该加那么多陪伴值但不管了，谁知道这里有逃课办法
        ;--------------------------------------------------
        CASE 304, 411, 412, 603
            SELECTCASE AME36_COM_COUNTER:(COM_EQUIVALENT - 300)
                CASE 1
                    PERCENTAGE_DUPE = 100
                    CFLAG:AME36_ATTENTION += 2
                    EXP_ADD = 2
                CASE 2 TO 4
                    PERCENTAGE_DUPE = 80
                    CFLAG:AME36_ATTENTION += 2
                    EXP_ADD = 2
                CASE 5 TO 8
                    PERCENTAGE_DUPE = 65
                    CFLAG:AME36_ATTENTION ++
                    EXP_ADD = 1
                CASE IS >= 9
                    PERCENTAGE_DUPE = 50
                    CFLAG:AME36_ATTENTION ++
            ENDSELECT
        ;--------------------------------------------------
        ;特殊：303道歉，SOURCE同衰竭最快，只有惹生气过才会记录经验，且仅记录一次
        ;--------------------------------------------------
        CASE 303
            SELECTCASE AME36_COM_COUNTER:(COM_EQUIVALENT - 300)
                CASE 1
                    PERCENTAGE_DUPE = 100
                    CFLAG:AME36_ATTENTION += 2
                CASE 2
                    PERCENTAGE_DUPE = 10
                CASE IS >= 3
                    PERCENTAGE_DUPE = 5
            ENDSELECT
            EXP_ADD = -10
            SIF CFLAG:AME36_RECOLLECTION_303 == -1
                CFLAG:AME36_RECOLLECTION_303 = 1
        ;--------------------------------------------------
        ;特殊：335照料，SOURCE同衰减快，用的是自己的COUNTER但加碰杯的经验
        ;--------------------------------------------------
        CASE 335
            SELECTCASE AME36_COM_COUNTER:(COM_EQUIVALENT - 300)
                CASE 1
                    PERCENTAGE_DUPE = 100
                    CFLAG:AME36_ATTENTION += 2
                    EXP_ADD = 2
                CASE 2
                    PERCENTAGE_DUPE = 60
                    CFLAG:AME36_ATTENTION += 2
                    EXP_ADD = 1
                CASE 3
                    PERCENTAGE_DUPE = 30
                    CFLAG:AME36_ATTENTION ++
                    EXP_ADD = 1
                CASE 4 TO 5
                    PERCENTAGE_DUPE = 10
                CASE 6 TO 9
                    PERCENTAGE_DUPE = 7
                    EXP_ADD = -1
                CASE IS >= 10
                    PERCENTAGE_DUPE = 5
                    EXP_ADD = -2
            ENDSELECT
            COM_EQUIVALENT = 334
        ;--------------------------------------------------
        ;特殊：626土产屋，SOURCE同衰减最快，但只有在购买礼物时才会增加经验（直接在这里加）
        ;--------------------------------------------------
        CASE 626
            IF TFLAG:194 < 0
                SELECTCASE AME36_COM_COUNTER:(COM_EQUIVALENT - 300)
                    CASE 1
                        PERCENTAGE_DUPE = 100
                        CFLAG:AME36_ATTENTION += 2
                    CASE 2
                        PERCENTAGE_DUPE = 10
                    CASE IS >= 3
                        PERCENTAGE_DUPE = 5
                ENDSELECT
            ELSE
                CFLAG:AME36_ATTENTION += 2
                CALL AME36_ADD_COM_RECOLLECTION(626, 1)
            ENDIF
            EXP_ADD = -10
        ;--------------------------------------------------
        ;其他情况，按照衰减最快处理
        ;--------------------------------------------------
        CASEELSE
            SELECTCASE AME36_COM_COUNTER:(COM_EQUIVALENT - 300)
                CASE 1
                    PERCENTAGE_DUPE = 100
                CASE 2
                    PERCENTAGE_DUPE = 10
                CASE IS >= 3
                    PERCENTAGE_DUPE = 5
            ENDSELECT
            EXP_ADD = -10
    ENDSELECT
    SIF GROUPMATCH(COM_EQUIVALENT, 403, 447, 448, 449, 605)
        MONO = 1
    ;--------------------------------------------------
    ;根据陷落状态追加经验、减少SOURCE惩罚
    ;--------------------------------------------------
    SELECTCASE AME36_FALL_STATE()
        CASE 1
            EXP_ADD ++
        CASE 2
            EXP_ADD += 2
        CASE 3
            EXP_ADD += 3
    ENDSELECT
    SIF MONO
        EXP_ADD = MIN(EXP_ADD, 1)
    ;--------------------------------------------------
    ;经验与SOURCE惩罚的结算
    ;--------------------------------------------------
    SIF EXP_ADD > 0
        CALL AME36_ADD_COM_RECOLLECTION(COM_EQUIVALENT, EXP_ADD)
    CALL AME36_TIMES_RELAVENT_SOURCE(PERCENTAGE_DUPE)
    CFLAG:AME36_COM_FAVOR = CFLAG:AME36_COM_FAVOR * PERCENTAGE_DUPE / 1000
    CFLAG:AME36_COM_TRUST = CFLAG:AME36_COM_TRUST * PERCENTAGE_DUPE / 1000
    ;PRINTFORML 3.{CFLAG:AME36_COM_TRUST}
ENDIF

RETURN 0

;==================================================
;COM的统一EXTRASOURCE函数
;==================================================
@M_KOJO_AME_EXTRASOURCE_COM_K36_GENERAL
#LOCALSIZE 1
#LOCALSSIZE 1
CALL AME36_EXTRASOURCE_GENERAL(SELECTCOM)
RETURN 0

;==================================================
;SCOM的统一EXTRASOURCE函数
;==================================================
@M_KOJO_AME_EXTRASOURCE_SCOM_K36_GENERAL
#LOCALSIZE 1
#LOCALSSIZE 1
CALL AME36_EXTRASOURCE_GENERAL(TFLAG:50 + 1000)
RETURN 0

;================================
;自定义商店按钮
;Y 是按钮的编号，范围是0-9
;使用的时候请删除SKIPSTART~SKIPEND。
;================================
[SKIPSTART]
;判断按钮是否可以显示，如果返回1，则显示
@KOJO_AME_CUSTOM_BUTTON_CONDITION_K36_Y
;custom_button_name:XX:Y = ボタンY
RETURN 1

;按钮被按下后，触发以下函数
@KOJO_AME_CUSTOM_BUTTON_K36_Y

RETURN 1
[SKIPEND]

;※※※※※※※※※※※※※※※※※※※※※※※※※※※※
;自定义指令
;※※※※※※※※※※※※※※※※※※※※※※※※※※※※

;==================================================
;COM298 - 指令失败时的占位函数
;==================================================
;指令名
;--------------------------------------------------
@KOJO_AME_COM_NAME_K36_28
#LOCALSIZE 1
#LOCALSSIZE 1
RESULTS = 不可以哦
RETURN 0

;--------------------------------------------------
;指令的执行条件（无法主动执行）
;--------------------------------------------------
@KOJO_AME_COM_ABLE_K36_28
#LOCALSIZE 1
#LOCALSSIZE 1
RETURN 0

;--------------------------------------------------
;指令的成功判定
;--------------------------------------------------
@KOJO_AME_COM_K36_28
#LOCALSIZE 1
#LOCALSSIZE 1
RETURN 1

;--------------------------------------------------
;指令的主内容
;--------------------------------------------------
@M_KOJO_AME_MESSAGE_COM_K36_298
#LOCALSIZE 1
#LOCALSSIZE 1
RETURN -1

;==================================================
;COM299 - 回忆值的显示
;==================================================
;指令名
;--------------------------------------------------
@KOJO_AME_COM_NAME_K36_29
#LOCALSIZE 1
#LOCALSSIZE 1
RESULTS = 回忆值
RETURN 0

;--------------------------------------------------
;指令的执行条件（与会话基本相同）
;--------------------------------------------------
@KOJO_AME_COM_ABLE_K36_29
#LOCALSIZE 1
#LOCALSSIZE 1
;SIF AME36_FALL_STATE() < 3
;    RETURN 0
SIF !TFLAG:100
	RETURN 0
SIF GLOBAL_COMABLE(300)
	RETURN RESULT
SIF CFLAG:ASLEEP_AMER && !CFLAG:SNUGGLE_AMER
	RETURN 0
SIF FLAG:TIMESTOP_AMER
	RETURN 0
RETURN 1

;--------------------------------------------------
;指令的成功判定
;--------------------------------------------------
@KOJO_AME_COM_K36_29
#LOCALSIZE 1
#LOCALSSIZE 1
RETURN 1

;--------------------------------------------------
;指令的主内容
;--------------------------------------------------
@M_KOJO_AME_MESSAGE_COM_K36_299
#LOCALSIZE 2
#LOCALSSIZE 1
#DIM CURRENT_PAGE = 1
#DIM MAX_PAGE = 3
#DIMS CURRENT_MODE = "444"
#DIM START_LINECOUNT
{
#DIMS ALCOHOL_NAMES = "浊酒", "清酒", "鬼杀酒", "红酒", "神酒", "甜酒", "蒸馏酒", "药酒", "一夜奇稻田", 
                      "烧酒", "蜂蜜酒", "果酒", "莓子酒", "白朗姆酒", "金朗姆酒", "黑朗姆酒", "强化红酒",
                      "贵腐红酒", "陈酿红酒", "优质陈酿红酒", "白兰地ＶＳ", "白兰地ＶＳＯＰ", "白兰地ＸＯ", 
                      "灰持酒", "果渣白兰地", "日本浊酒", "吟酿酒", "熟成酒", "古酒", "酒粕烧酎‌", 
                      "贵酿日本浊酒", "贵酿酒", "贵酿熟成酒", "贵酿古酒", "三增酒"
}
#DIMS TDISH_NAME
#DIMS TDISH_TASTE
#DIMS TDISH_TYPE
#DIMS TDISH_COMMENT
#DIM TDISH_ING, 11
#DIM TDISH_TIME
#DIM TDISH_MAXLIMIT
RESETCOLOR

PRINTFORMW 与阿燐忆起相识以来的种种过往……
CLEARLINE 1
START_LINECOUNT = LINECOUNT
$RECOLLECTION_LOOP
;--------------------------------------------------
;这里是表头
;--------------------------------------------------
PRINTFORML 总回忆值：{AME36_RECOLLECTION()}
DRAWLINE
;--------------------------------------------------
;这里是表格的主内容
;--------------------------------------------------
IF CURRENT_MODE == "444"
    IF CURRENT_PAGE == 1
        PRINTPLAINFORM [300]会话　　　　　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_300, 35, 100, 340, 890, 2000, 1000), 4000, 1)
        PRINTPLAINFORM [301]泡茶　　　　　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_301, 21, 60, 210, 560, 1200, 720), 2000, 1)
        PRINTPLAINFORM [302]身体接触　　　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_302, 0, 0, 180, 580, 1200, 480), 3000, 1)
        PRINTPLAINFORM [303]道歉　　　　　　
        SELECTCASE CFLAG:AME36_RECOLLECTION_303
            CASE -1
                CALL COLORMESSAGE("惹阿燐生气却不道歉的家伙(-200)", C_RED, 1)
            CASE 0
                CALL COLORMESSAGE("没有惹阿燐生气过哦", C_AQUA, 1)
            CASE 1
                CALL COLORMESSAGE("有好好道歉过、所以没有惩罚", C_GREEN, 1)
        ENDSELECT
        PRINTPLAINFORM [304]帮忙干活　　　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_304, 0, 26, 116, 316, 700, 245), 2000, 1)
        PRINTPLAINFORM [305]膝枕／索求膝枕　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_305, 0, 0, 90, 290, 600, 300), 1200, 1)
        PRINTPLAINFORM [306]抚摸小腹　　　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_306, 0, 0, 0, 100, 300, 150), 600, 1)
        PRINTPLAINFORM [307]捏脸蛋　　　　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_307, 0, 0, 90, 290, 600, 450), 800, 1)
        PRINTPLAINFORM [308]戳脸颊　　　　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_308, 0, 0, 0, 100, 300, 150), 600, 1)
        PRINTPLAINFORM [309]摸头　　　　　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_309, 0, 0, 90, 290, 600, 300), 1200, 1)
        PRINTPLAINFORM [310]摸屁股　　　　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_310, 0, 0, 0, 200, 600, 600), 600, 1)
        PRINTPLAINFORM [311]拥抱　　　　　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_311, 0, 0, 90, 290, 600, 300), 1200, 1)
        PRINTPLAINFORM [330]掀起裙子　　　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_330, 0, 0, 0, 100, 300, 225), 400, 1)
        PRINTPLAINFORM [332]劝酒　　　　　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_332, 0, 13, 58, 158, 360, 216), 600, 1)
        PRINTPLAINFORM [333]听牢骚　　　　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_333, 0, 1, 2, 3, 5, -8), 200, 1)
        PRINTPLAINFORM [334]碰杯／照料　　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_334, 0, 8, 38, 104, 240, 72), 800, 1)
        PRINTPLAINFORM [354]陪睡　　　　　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_354, 0, 0, 0, 100, 300, 150), 600, 1)
        PRINTPLAINFORM [403]休憩　　　　　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_403, 0, 0, 10, 20, 50, 5), 500, 1)
        PRINTPLAINFORM [410]扫除　　　　　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_410, 14, 40, 130, 330, 700, 490), 1000, 1)
        PRINTPLAINFORM [411]战斗训练　　　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_411, 0, 52, 232, 632, 1500, 750), 3000, 1)
    ELSEIF CURRENT_PAGE == 2
        PRINTPLAINFORM [412]学习　　　　　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_412, 0, 52, 232, 632, 1500, 750), 3000, 1)
        PRINTPLAINFORM [413]制作料理　　　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_413, 0, 52, 232, 632, 1500, 1125), 2000, 1)
        PRINTPLAINFORM [414]吃饭／招待吃饭　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_414, 14, 40, 130, 330, 720, 432), 1200, 1)
        PRINTPLAINFORM [416]演奏　　　　　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_416, 4, 13, 43, 109, 240, 72), 800, 1)
        PRINTPLAINFORM [417]午睡　　　　　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_417, 0, 0, 0, 4, 10, -4), 400, 1)
        PRINTPLAINFORM [431]在浴室里放松　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_431, 0, 0, 90, 290, 600, 360), 1000, 1)
        PRINTPLAINFORM [432]钱汤　　　　　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_432, 0, 0, 12, 40, 100, 25), 400, 1)
        PRINTPLAINFORM [436]读书　　　　　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_436, 0, 0, 90, 290, 600, 240), 1500, 1)
        PRINTPLAINFORM [440]等待　　　　　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_440, 0, 0, 2, 5, 10, -2), 200, 1)
        PRINTPLAINFORM [442]伐采　　　　　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_442, 0, 0, 12, 40, 100, 20), 500, 1)
        PRINTPLAINFORM [445]采集　　　　　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_445, 0, 26, 216, 316, 700, 245), 2000, 1)
        PRINTPLAINFORM [446]进行调合　　　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_446, 0, 13, 58, 158, 400, 80), 2000, 1)
        PRINTPLAINFORM [447]路边摆摊　　　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_447, 0, 0, 2, 5, 10, -8), 800, 1)
        PRINTPLAINFORM [448]设下陷阱　　　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_448, 0, 1, 2, 5, 10, -4), 400, 1)
        PRINTPLAINFORM [449]捕虫　　　　　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_449, 0, 2, 5, 10, 20, 1), 400, 1)
        PRINTPLAINFORM [480]弹幕胜负　　　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_480, 0, 1, 2, 5, 10, -6), 600, 1)
        PRINTPLAINFORM [483]斗虫　　　　　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_483, 1, 1, 2, 3, 5, -8), 200, 1)
        PRINTPLAINFORM [484]打西瓜　　　　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_484, 1, 1, 2, 3, 5, -8), 200, 1)
        PRINTPLAINFORM [603]牵手／拉手　　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_603, 0, 0, 90, 290, 600, 450), 800, 1)
        PRINTPLAINFORM [605]绕道　　　　　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_605, 0, 0, 2, 5, 10, -4), 400, 1)
    ELSEIF CURRENT_PAGE == 3
        PRINTPLAINFORM [610]请吃饭　　　　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_610, 0, 0, 2, 5, 10, -4), 400, 1)
        PRINTPLAINFORM [614]采购食材　　　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_614, 0, 0, 1, 2, 5, -8), 200, 1)
        PRINTPLAINFORM [615]吃便当　　　　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_615, 0, 0, 0, 66, 200, 80), 500, 1)
        PRINTPLAINFORM [617]邀请去甜品店　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_617, 0, 0, 1, 2, 5, -16), 400, 1)
        PRINTPLAINFORM [621]钓鱼　　　　　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_621, 0, 0, 180, 580, 1300, 845), 2000, 1)
        PRINTPLAINFORM [626]送礼　　　　　　
        CALL AME36_COMPLETION_PRINT(AME36_COM_RECOLLECTION(CFLAG:AME36_RECOLLECTION_626, 0, 5, 10, 20, 50, 1), 2500, 1)
    ENDIF
ELSEIF CURRENT_MODE == "555"
    
ELSEIF CURRENT_MODE == "666"
    PRINTFORM 与阿燐一起度过的时光　
    CALL AME36_COMPLETION_PRINT(AME36_PERSISTENCE_RECOLLECTION(), 10000, 1)
    PRINTBUTTON "喝过酒的种类　　　　　", "901"
    CALL AME36_COMPLETION_PRINT(AME36_ALCOHOL_RECOLLECTION(), 1000, 1)
    PRINTBUTTON "做过料理的种类　　　　", "902"
    CALL AME36_COMPLETION_PRINT(AME36_DISH_RECOLLECTION(), 2000, 1)
ENDIF
DRAWLINE
;--------------------------------------------------
;这里是表尾的选项部分
;--------------------------------------------------
IF CURRENT_PAGE == 1
    SETCOLOR C_L_GRAY
    PRINTPLAIN [111]　上一页
    RESETCOLOR
ELSE
    PRINTBUTTON "[111]　上一页", "111"
ENDIF
PRINT 　　　　
PRINTBUTTON "[222]　结束回忆", "222"
PRINT 　　　
IF CURRENT_PAGE == MAX_PAGE
    SETCOLOR C_L_GRAY
    PRINTPLAIN [333]　下一页
    RESETCOLOR
ELSE
    PRINTBUTTON "[333]　下一页", "333"
ENDIF
PRINTL
IF CURRENT_MODE == "444"
    SETCOLOR C_L_GRAY
    PRINTPLAIN [444]　ＣＯＭ相关
    RESETCOLOR
ELSE
    PRINTBUTTON "[444]　ＣＯＭ相关", "444"
ENDIF
PRINT 　　
IF CURRENT_MODE == "555"
    SETCOLOR C_L_GRAY
    PRINTPLAIN [555]　特殊事件
    RESETCOLOR
ELSE
    PRINTBUTTON "[555]　特殊事件", "555"
ENDIF
PRINT 　　　
IF CURRENT_MODE == "666"
    SETCOLOR C_L_GRAY
    PRINTPLAIN [666]　杂项
    RESETCOLOR
ELSE
    PRINTBUTTON "[666]　杂项", "666"
ENDIF
INPUTS
SIF RESULTS == "222"
    RETURN 1
SIF RESULTS == "111"
    CURRENT_PAGE = MAX(CURRENT_PAGE - 1, 1)
SIF RESULTS == "333"
    CURRENT_PAGE = MIN(CURRENT_PAGE + 1, MAX_PAGE)
IF GROUPMATCH(RESULTS, "444", "555", "666")
    CURRENT_MODE '= RESULTS
    CURRENT_PAGE = 1
    SELECTCASE RESULTS
        CASE "444"
            MAX_PAGE = 3
        CASE "555"
            MAX_PAGE = 1
        CASE "666"
            MAX_PAGE = 1
    ENDSELECT
ENDIF
;--------------------------------------------------
;酒和料理的完成度显示
;--------------------------------------------------
IF CURRENT_MODE == "666"
    IF RESULTS == "901"
        DRAWLINE
        PRINTFORML □都一起喝过什么酒呢□
        FOR LOCAL, 0, 34
            SIF GETBIT(CFLAG:AME36_ALCOHOL_TYPE, LOCAL)
                SETCOLOR C_GREEN
            STRLENFORM %ALCOHOL_NAMES:LOCAL%
            PRINTFORM %ALCOHOL_NAMES:LOCAL%%"　" * (8 - RESULT / 2)%
            RESETCOLOR
            SIF (LOCAL + 1) % 3 == 0
                PRINTL
        NEXT
        PRINTL
        PRINTW
    ELSEIF RESULTS == "902"
        VARSET LOCAL
        TDISH_NAME '= DISH_NAME
        TDISH_TASTE '= DISH_TASTE
        TDISH_TYPE '= DISH_TYPE
        TDISH_COMMENT '= DISH_COMMENT
        FOR LOCAL, 0, 11
	        TDISH_ING:LOCAL = DISH_ING:LOCAL
        NEXT
        TDISH_TIME = DISH_TIME
        TDISH_MAXLIMIT = DISH_MAXLIMIT

        DRAWLINE
        PRINTFORML □都一起做过什么料理呢□
        PRINTFORML ＜轻食＞
        FOR LOCAL, 101, 200
            SELECTCASE LOCAL
                CASE 101 TO 103, 111 TO 119, 121 TO 127, 131 TO 146, 151 TO 166, 171 TO 174, 181 TO 185, 191 TO 196
                    IF LOCAL:1 <= 63
                        SIF GETBIT(CFLAG:AME36_DISH_TYPE_1, LOCAL:1)
                            SETCOLOR C_GREEN
                    ELSE
                        SIF GETBIT(CFLAG:AME36_DISH_TYPE_2, LOCAL:1 - 64)
                            SETCOLOR C_GREEN
                    ENDIF
                    CALL DISHDATA(LOCAL)
                    STRLENFORM %DISH_NAME%
                    PRINTFORM %DISH_NAME%%"　" * (10 - RESULT / 2)%
                    RESETCOLOR
                    SIF (LOCAL:1 + 1) % 4 == 0
                        PRINTL
                    LOCAL:1 += 1
            ENDSELECT
        NEXT
        PRINTL
        PRINTL
        PRINTFORML ＜主食＞
        FOR LOCAL, 201, 300
            SELECTCASE LOCAL
                CASE 201 TO 221, 231 TO 238, 241 TO 251, 261 TO 273, 281 TO 287, 291 TO 295
                    IF LOCAL:1 <= 127
                        SIF GETBIT(CFLAG:AME36_DISH_TYPE_2, LOCAL:1 - 64)
                            SETCOLOR C_GREEN
                    ELSE
                        SIF GETBIT(CFLAG:AME36_DISH_TYPE_3, LOCAL:1 - 128)
                            SETCOLOR C_GREEN
                    ENDIF
                    CALL DISHDATA(LOCAL)
                    STRLENFORM %DISH_NAME%
                    PRINTFORM %DISH_NAME%%"　" * (10 - RESULT / 2)%
                    RESETCOLOR
                    SIF (LOCAL:1 - 1) % 4 == 0
                        PRINTL
                    LOCAL:1 += 1
            ENDSELECT
        NEXT
        PRINTL
        PRINTL
        PRINTFORML ＜甜点＞
        FOR LOCAL, 301, 350
            SELECTCASE LOCAL
                CASE 301 TO 330, 341 TO 343
                    SIF GETBIT(CFLAG:AME36_DISH_TYPE_3, LOCAL:1 - 128)
                        SETCOLOR C_GREEN
                    CALL DISHDATA(LOCAL)
                    STRLENFORM %DISH_NAME%
                    PRINTFORM %DISH_NAME%%"　" * (10 - RESULT / 2)%
                    RESETCOLOR
                    SIF (LOCAL:1 - 2) % 4 == 0
                        PRINTL
                    LOCAL:1 += 1
            ENDSELECT
        NEXT
        PRINTL
        PRINTL
        PRINTFORML ＜跳蛋？＞
        FOR LOCAL, 351, 360
            SELECTCASE LOCAL
                CASE 351 TO 355
                    SIF GETBIT(CFLAG:AME36_DISH_TYPE_3, LOCAL:1 - 128)
                        SETCOLOR C_GREEN
                    CALL DISHDATA(LOCAL)
                    STRLENFORM %DISH_NAME%
                    PRINTFORM %DISH_NAME%%"　" * (10 - RESULT / 2)%
                    RESETCOLOR
                    SIF (LOCAL:1 + 1) % 4 == 0
                        PRINTL
                    LOCAL:1 += 1
            ENDSELECT
        NEXT
        PRINTL
        PRINTL
        LOCAL:1 = 1
        PRINTFORML ＜固有料理＞
        IF CFLAG:AME36_DISH_TYPE_C1 + CFLAG:AME36_DISH_TYPE_C2 + CFLAG:AME36_DISH_TYPE_C3 == 0
            PRINTFORML 还什么都没有哦
        ELSE
            SETCOLOR C_GREEN
            FOR LOCAL, 401, 401 + CHARANUM
                IF LOCAL <= 464
                    SIF !GETBIT(CFLAG:AME36_DISH_TYPE_C1, LOCAL - 401)
                        CONTINUE
                ELSEIF LOCAL <= 528
                    SIF !GETBIT(CFLAG:AME36_DISH_TYPE_C1, LOCAL - 465)
                        CONTINUE
                ELSEIF LOCAL <= 592
                    SIF !GETBIT(CFLAG:AME36_DISH_TYPE_C1, LOCAL - 529)
                        CONTINUE
                ENDIF
                CALL DISHDATA(LOCAL)
                STRLENFORM %DISH_NAME%
                PRINTFORM %DISH_NAME%
                IF RESULT % 2 == 1
                    PRINTFORM %" "%
                    RESULT += 1
                ENDIF
                PRINTFORM %"　" * (10 - RESULT / 2)%
                SIF LOCAL:1 % 4 == 0
                    PRINTL
                LOCAL:1 += 1
            NEXT
            RESETCOLOR
            PRINTL
        ENDIF
        PRINTW

        DISH_NAME '= TDISH_NAME
        DISH_TASTE '= TDISH_TASTE
        DISH_TYPE '= TDISH_TYPE
        DISH_COMMENT '= TDISH_COMMENT
        FOR LOCAL, 0, 11
        	DISH_ING:LOCAL = TDISH_ING:LOCAL
        NEXT
        DISH_TIME = TDISH_TIME
        DISH_MAXLIMIT = TDISH_MAXLIMIT
    ENDIF
ENDIF
CLEARLINE LINECOUNT - START_LINECOUNT
GOTO RECOLLECTION_LOOP

CALL M_KOJO_AME_COLOR_K36
RETURN 1

;--------------------------------------------------
;为了简化代码的一个工具函数
;--------------------------------------------------
@AME36_COMPLETION_PRINT(PROGRESS, MAX_VALUE, IS_L)
#LOCALSIZE 1
#LOCALSSIZE 1
#DIM PROGRESS
#DIM MAX_VALUE
#DIM IS_L
IF PROGRESS == MAX_VALUE
    LOCALS = ({PROGRESS}/{MAX_VALUE})
    CALL COLORMESSAGE(LOCALS, C_GREEN, IS_L)
ELSE
    IF IS_L
        PRINTFORML ({PROGRESS}/{MAX_VALUE})
    ELSE
        PRINTFORM ({PROGRESS}/{MAX_VALUE})
    ENDIF
ENDIF
RETURN 1

;==================================================
;自定义COUNTER触发概率
;ARG为COUNTER编号
;==================================================
@M_KOJO_AME_CHECK_K36_CCOM_ORDER(ARGS, ARG, ARG:2)
#LOCALSIZE 1
#LOCALSSIZE 1
RETURN -1

;==================================================
;自定义移动倾向以及特殊食谱
;==================================================
@M_KOJO_AME_CHECK_K36_CHARADATA(ARGS, ARG, ARG:2)
#LOCALSIZE 1
#LOCALSSIZE 1
;--------------------------------------------------
;覆盖原版的@CHARAMOVE_DATA_36
;--------------------------------------------------
IF ARGS == "MOVE"
    SELECTCASE ARG
        ;--------------------------------------------------
        ;控制外出时一同遭遇
        ;跟在阿空或觉大人身边各1/4概率
        ;--------------------------------------------------
        CASE 1
       		IF BETWEENTIME(660, 1080) || (AME36_WEEKDAY_MATCH(0, 6) && BETWEENTIME(420, 1080))
                IF !RAND:4
                    RETURN 37
                ELSEIF !RAND:3
                    RETURN 49
                ENDIF
            ENDIF
            RETURN 36
       	;--------------------------------------------------
        ;生活时间补正的修改（暂时用不到）
        ;--------------------------------------------------
       	;CASE 3
       	;--------------------------------------------------
        ;移动倾向
        ;大于0表示偏好，小于0表示少去，-100表示不去
        ;--------------------------------------------------
       	CASE 4
       		SELECTCASE ARG:2
                ;--------------------------------------------------
                ;如果阿空在房间就一起玩
                ;--------------------------------------------------
                CASE 911
                    SIF CFLAG:37:LOCATION_AMER == 911
                        RETURN 10
       			;--------------------------------------------------
                ;偏爱地点：书斋、蔷薇园、酒场、温泉
                ;真的有不喜欢看书赏花喝酒泡温泉的猫嘛
                ;--------------------------------------------------
       			CASE 920, 925, 933, 934
       				RETURN 5
       			;--------------------------------------------------
                ;偏好地点：厨房、露台、风吕、川岸、桥
                ;给觉大人做完饭看看风景
                ;--------------------------------------------------
       			CASE 909, 915, 921, 945, 946
       				RETURN 3
                ;--------------------------------------------------
                ;少去地点：大会堂、觉大人的房间、地狱的人工太阳、旧血池地狱
                ;主要是确实没什么理由去的地方
                ;--------------------------------------------------
                CASE 904, 919, 929, 930
                    RETURN -3
                ;--------------------------------------------------
                ;更少去地点：恋大人的房间、鬼的聚集场所、血枪的房间
                ;--------------------------------------------------
                CASE 918, 938, 947
                    RETURN -5
                ;--------------------------------------------------
                ;不去地点：两个MASTER可选的初期房间，情人旅馆，勇仪、帕露、山女、小桶的房间，某个空房间，托卡马克装置核心（反正也进不去）
                ;--------------------------------------------------
       			CASE 916, 935, 936, 937, 940, 941, 942, 943, 949
       				RETURN -100
       		ENDSELECT
            ;--------------------------------------------------
            ;因为原版代码的bug，如果 RETURN 0 就会被原版覆盖，所以只能全部都 RETURN 1 了
            ;--------------------------------------------------
            RETURN 1
       	;--------------------------------------------------
        ;在主地图外的出现场所
        ;--------------------------------------------------
       	CASE 7
       		SELECTCASE ARG:2
                ;--------------------------------------------------
                ;博丽神社：樱花道的鸟居、神社境内、神社本堂、神社走廊
                ;--------------------------------------------------
       			CASE 10, 20, 30, 40
       				RETURN 1
                ;--------------------------------------------------
                ;命莲寺：墓地
                ;--------------------------------------------------
       			CASE 150
       				RETURN 1
                ;--------------------------------------------------
                ;人里：商家町
                ;--------------------------------------------------
                CASE 220
                    RETURN 1
                ;--------------------------------------------------
                ;魔法森林：无缘塚
                ;--------------------------------------------------
                CASE 570
                    RETURN 1
                ;--------------------------------------------------
                ;三途之川冥界：迷途之家
                ;--------------------------------------------------
                CASE 630
                    RETURN 1
                ;--------------------------------------------------
                ;妖怪之山山麓：间歇泉地下中枢
                ;--------------------------------------------------
       			CASE 760
       				RETURN 1
                ;--------------------------------------------------
                ;地底：幻想风穴、地狱的深道、旧地狱街道、旧地狱温泉、地灵殿、灼热地狱迹
                ;--------------------------------------------------
       			CASE 910, 920, 930, 940, 960, 970
       				RETURN 1
       		ENDSELECT
        ;--------------------------------------------------
        ;引力点的设定
        ;用了这个就不需要用GRAVITY函数了
        ;--------------------------------------------------
       	CASE 8
            ;--------------------------------------------------
            ;当觉大人或阿空处于危险状态时，立马赶过去
            ;WIP：根据警惕值计算行动概率
            ;--------------------------------------------------
       		IF AME36_DANGEROUS(49)
                CFLAG:GRAVITY_AMER = CFLAG:49:LOCATION_AMER
                RETURN 0
            ENDIF
            IF AME36_DANGEROUS(37)
                CFLAG:GRAVITY_AMER = CFLAG:37:LOCATION_AMER
                RETURN 0
            ENDIF
            ;--------------------------------------------------
            ;平时1/10概率跟着觉大人
            ;--------------------------------------------------
            SIF CFLAG:AME36_RAND_TODAY % 10 == 0
                CFLAG:GRAVITY_AMER = CFLAG:49:LOCATION_AMER
    ENDSELECT
ELSEIF ARGS == "SPECIAL_MENU"
	DISH_NAME = 琥珀渔夫派
	RESULTS = 主食
	CALL 材料設定("魚", "好吃的魚")
	DISH_TASTE = 魚料理/牛奶/卵/派/洋食/地底風/怪诞/简易/質素/家庭的/软绵绵/软绵绵/甜/咸/
	DISH_COMMENT = 用红薯替代土豆泥、焦糖与蜂蜜凝成琥珀外壳。甜咸交融中、是西洋与地底怪诞风格的碰撞。
	RETURN 1
ENDIF
RETURN 0
